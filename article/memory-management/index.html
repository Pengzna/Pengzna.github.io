<!DOCTYPE html>
<html lang="en">

  <head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="Pengzna,blog" />
  <meta name="author" content="Pengzna" />
  <meta name="description" content="Pengzna çš„åšå®¢" />
  
  
  <title>
    
      Apache HugeGraph å†…å­˜ç®¡ç†æ¡†æ¶çš„è®¾è®¡ä¸å®ç° 
      
      
    
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto:400,400italic,600|Roboto+Mono" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/css/common.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">


  

  
    
<link rel="stylesheet" href="/css/post.css">

  

  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


<meta name="generator" content="Hexo 7.0.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>


  <body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="app">
      <div class="header">
  <a href="/">Pengzna's blog ğŸ‘‹</a>
</div>


      <p class="links">
  
    <a title="archives" target="" href="/archives/">
      <i class="iconfont icon-bookmark"></i>
    </a>
  
    <a title="github" target="_blank" href="https://github.com/Pengzna">
      <i class="iconfont icon-github"></i>
    </a>
  
    <a title="email" target="_blank" href="mailto:junzhi.pengzna@gmail.com">
      <i class="iconfont icon-envelope"></i>
    </a>
  
    <a title="linkedin" target="_blank" href="https://www.linkedin.com/in/pengzna/">
      <i class="iconfont icon-linkedin"></i>
    </a>
  
    <a title="wechat" target="_blank" href="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20231115013033249.png">
      <i class="iconfont icon-wechat"></i>
    </a>
  
</p>


      <div class="main">
        <!-- æ–‡ç« è¯¦æƒ…é¡µï¼Œå±•ç¤ºæ–‡ç« å…·ä½“å†…å®¹ï¼Œurlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
<!-- åŒæ—¶ä¸ºã€Œæ ‡ç­¾tagã€ï¼Œã€Œæœ‹å‹friendã€ï¼Œã€Œåˆ†ç±»categoriesã€ï¼Œã€Œå…³äºaboutã€é¡µé¢çš„æ‰¿è½½é¡µé¢ï¼Œå…·ä½“å±•ç¤ºå–å†³äºpage.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
</script>

<div class="post">
  <h3 class="date">
    Nov 05, 2024
  </h3>
  <h1>
    Apache HugeGraph å†…å­˜ç®¡ç†æ¡†æ¶çš„è®¾è®¡ä¸å®ç°
  </h1>
  <div class="content markdown-body">
    <p>ç¬”è€…åœ¨ 2024 å¹´æœ‰å¹¸å‚ä¸äº† Apache HugeGraph çš„å†…å­˜ç®¡ç†å·¥ä½œï¼Œä» 0 åˆ° 1 æ­å»ºäº† Apache HugeGraph å¯¹äº Query çš„å†…å­˜ç®¡æ§ã€‚</p>
<p>å¯¹äºä¸€ä¸ª Java base çš„ç³»ç»Ÿï¼Œå †å†…å­˜å…¨éƒ¨æ˜¯ç”± JVM ä»¥åŠ GC è¿›è¡Œç®¡æ§ã€‚æœ¬é¡¹ç›®çš„éš¾ç‚¹å’Œäº®ç‚¹åœ¨äºï¼Œåœ¨ JVM çš„æ¡†æ¶ä¸‹å¯¹å†…å­˜è¿›è¡Œçµæ´»çš„åˆ†é…ã€å»é…ä»¥åŠç›‘æ§ç®¡ç†ï¼Œå®ç°æ›´åŠ ä¸ªæ€§åŒ–ã€ç²¾ç»†åŒ–çš„å†…å­˜è°ƒæ§ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼ŒApache HugeGraph çš„ Query é“¾è·¯å¯èƒ½æœ‰æå¤§çš„è´Ÿè½½ï¼Œå¯¼è‡´æŸäº›æ—¶é—´çª—å£å†…ï¼Œå†…å­˜ä½¿ç”¨å‹åŠ›æå¤§ã€‚</p>
<ul>
<li>å¦‚æœä½¿ç”¨å †å†…å­˜ï¼Œä¾èµ– JVM è¿›è¡Œç®¡æ§çš„è¯ææ˜“å› ä¸º Full GC é€ æˆä¸å¯æ§çš„ stw ä»è€Œå½±å“æ‰€æœ‰é“¾è·¯çš„ä¸šåŠ¡ã€‚<ul>
<li>æˆ‘ä»¬å¸Œæœ›å‡å°‘ Full GC çš„å½±å“ï¼Œå¹¶ä¸”å³ä½¿å†…å­˜ä¸è¶³ï¼Œä¹Ÿä¸è¦ stw å½±å“å…¨éƒ¨é“¾è·¯çš„ä¸šåŠ¡ã€‚å¯ä»¥é€šè¿‡æš‚æ—¶ hang æŸä¸€æ¡é“¾è·¯ä»è€Œä¿è¯å…¶ä»–ä¸šåŠ¡çš„æ­£å¸¸è¿›è¡Œã€‚</li>
</ul>
</li>
<li>ä½¿ç”¨ JVM åŸç”Ÿçš„å†…å­˜ç®¡æ§æ¡†æ¶æ— æ³•å®ç°ç»†ç²’åº¦çš„å†…å­˜è°ƒæ§<ul>
<li>æˆ‘ä»¬å¸Œæœ›å¯¹äºå„ç§ç»†ç²’åº¦çš„å†…å­˜åˆ†é…ã€å»é…éƒ½èƒ½ç™½ç›’ç®¡ç†ï¼Œå¹¶è¾…åŠ©å¯¹å…¨å±€ä¸šåŠ¡æµè¿›è¡Œè°ƒé…ï¼Œä»è€Œä¿è¯ç³»ç»Ÿçš„ç¨³æ­¥è¿è¡Œè€Œä¸æ˜¯å¡æ­»ã€‚</li>
</ul>
</li>
</ul>
<p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘åŸºäºå †å¤–å†…å­˜ã€é›¶æ‹·è´åºåˆ—åŒ–ã€æ ‘å½¢å±‚æ¬¡å¼å†…å­˜ç®¡ç†æ¶æ„ç­‰è§’åº¦æå‡ºäº†è§£å†³æ–¹æ¡ˆï¼Œå¹¶åˆå…¥äº† Apache HugeGraph çš„ä¸»åˆ†æ”¯ã€‚</p>
<p>æœ¬æ–‡æ¡£ä¸ºä¸­æ–‡ç‰ˆï¼ŒåŸç‰ˆæ–‡æ¡£å¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/apache/incubator-hugegraph/wiki/%5BMemory-Management%5D-GSoC-2024-Final-Report">https://github.com/apache/incubator-hugegraph/wiki/%5BMemory-Management%5D-GSoC-2024-Final-Report</a></p>
<h2 id="Project-Overview"><a href="#Project-Overview" class="headerlink" title="Project Overview"></a>Project Overview</h2><p>To reduce request latency and response time jitter, the hugegraph-server graph queryï¼Œengine has already used off-heap memory in most OLTP algorithms. However, at present, hugegraph cannot control memory based on a single request Query, so a Query may exhaust the memory of the entire process and cause OOM, or even cause the service to be unable to respond to other requests. Need to implement a memory management module based on a single Query.</p>
<p>Key goals includes:</p>
<ul>
<li>Implement a <strong>unified memory manager</strong>, independently manage JVM off-heap memory, and adapt the memory allocation methods of various native collections, so that the memory mainly used by the algorithm comes from the unified memory pool, and it is returned to the memory pool after release.</li>
<li>Each request corresponds to a unified memory manager, and the memory usage of a request can be controlled by counting the memory usage of a request.</li>
<li>Complete related <strong>unit tests UT</strong> and basic documentation.</li>
</ul>
<h2 id="Feature-Implemented"><a href="#Feature-Implemented" class="headerlink" title="Feature Implemented"></a>Feature Implemented</h2><h3 id="Feature1-Hierarchical-Memory-Allocation"><a href="#Feature1-Hierarchical-Memory-Allocation" class="headerlink" title="Feature1: Hierarchical Memory Allocation"></a>Feature1: Hierarchical Memory Allocation</h3><h4 id="Designï¼š"><a href="#Designï¼š" class="headerlink" title="Designï¼š"></a>Designï¼š</h4><p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20241030174412113.png" alt="image-20241030174412113"></p>
<ul>
<li><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¯¹äºä¸åŒå±‚æ¬¡çš„æ‰§è¡Œç»„ä»¶ï¼Œæˆ‘ä»¬åˆ†é…ä¸åŒå±‚æ¬¡çš„ MemoryPool(MemoryContext)ï¼Œåˆ†åˆ«å¯¹åº”ç®¡ç†ã€‚</p>
<ul>
<li><p><strong>æ¯ä¸ª</strong> <strong>Query</strong> å¯¹åº”ä¸€ä¸ª <strong>QueryMemoryPool</strong></p>
</li>
<li><p>ä¸€ä¸ª Query æ´¾ç”Ÿå‡ºçš„<strong>æ¯ä¸ª Taskï¼ˆæ¯ä¸ªçº¿ç¨‹ï¼‰</strong>ï¼Œå¯¹åº”ä¸€ä¸ª <strong>TaskMemoryPool</strong></p>
</li>
<li><p>ä¸€ä¸ª Task ä½¿ç”¨çš„<strong>æ¯ä¸ª Operatorï¼ˆå¦‚ HG ä¸­çš„å„ç§è¿­ä»£å™¨ï¼‰</strong>ï¼Œå¯¹åº”ä¸€ä¸ª <strong>OperatorMemoryPool</strong></p>
</li>
<li><p>MemoryManager ç®¡ç†æ‰€æœ‰çš„ MemoryPool</p>
</li>
<li><p><strong>ç”Ÿå‘½å‘¨æœŸç›¸è¿‘</strong>çš„å¯¹è±¡å°½é‡æ”¾åœ¨ä¸€ä¸ª MemoryContext é‡Œï¼Œè®¿é—®çš„æ—¶å€™ä¸è·¨ç‰©ç†å†…å­˜ï¼Œé‡Šæ”¾æ—¶ä¸€èµ·é‡Šæ”¾</p>
</li>
</ul>
</li>
</ul>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å¯¹æ¯ä¸ªæŸ¥è¯¢ä»»åŠ¡çš„å†…å­˜å®é™…ä½¿ç”¨é‡çš„ç²¾ç»†è¿½è¸ªï¼Œç²¾ç¡®åˆ°è¿ç®—ç¬¦çº§åˆ«ã€‚è¿™æ ·ï¼Œå¯¹äºå…¨å±€çš„å†…å­˜ä½¿ç”¨å’Œæ§åˆ¶ä¾¿èƒ½è¾¾åˆ°æœ€ä½³æ•ˆæœã€‚</p>
<p>ä»¥ä¸Šä¸‰ç§ MemoryPool å¯ä»¥ç»„æˆä¸€ä¸ª MemoryPool<strong>Tree</strong>ï¼Œæ ¹èŠ‚ç‚¹æ˜¯ MemoryManagerï¼Œå¶å­èŠ‚ç‚¹æ˜¯ OperatorPool</p>
<ul>
<li><p>çœŸæ­£éœ€è¦ä½¿ç”¨å†…å­˜çš„æ˜¯<strong>å¶å­èŠ‚ç‚¹</strong> <strong>OperatorPool</strong></p>
</li>
<li><p>ä¸Šå±‚çš„ TaskPool å’Œ QueryPool æœ¬è´¨ä¸Šä¸ç”³è¯·ä½¿ç”¨å†…å­˜ï¼Œå®ƒä»¬ä½œä¸º<strong>èšåˆæ± </strong>ï¼ŒæŠŠåº•å±‚å¶å­èŠ‚ç‚¹çš„ä½¿ç”¨æƒ…å†µèšåˆèµ·æ¥ã€‚å¹¶ä¸”ä½œä¸ºç®¡ç†å­æ± çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
</li>
</ul>
<p>å†…å­˜æ± çš„<strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼š</p>
<ul>
<li><p>QueryMemoryPoolï¼šæ¯ä¸ª query è¯·æ±‚å…¥å£å¤„åˆ›å»ºï¼Œå¦‚ http query è¯·æ±‚ã€‚query ç»“æŸæ—¶ releaseï¼Œå¹¶é‡Šæ”¾å¯¹åº”å†…å­˜</p>
</li>
<li><p>TaskMemoryPoolï¼šæ¯å½“ Submit ä¸€ä¸ªæ–°çº¿ç¨‹ä»»åŠ¡æ—¶åˆ›å»ºï¼Œå¦‚ Executor.submit(() -&gt; doSomething())ã€‚çº¿ç¨‹ä»»åŠ¡ç»“æŸæ—¶ releaseï¼Œå¹¶é‡Šæ”¾å¯¹åº”å†…å­˜</p>
</li>
<li><p>OperatorMemoryPoolï¼šæ¯å½“åˆ›å»ºä¸€ä¸ª Iterator æ—¶åˆ›å»ºï¼Œä¸ä¸»åŠ¨ releaseï¼Œåªæœ‰å½“ä¸Šå±‚çš„ TaskMemoryPool release æ—¶è§¦å‘è‡ªå·±çš„é‡Šæ”¾ã€‚</p>
</li>
</ul>
<h4 id="Effectï¼š"><a href="#Effectï¼š" class="headerlink" title="Effectï¼š"></a>Effectï¼š</h4><p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20241031205631529.png" alt="image-20241031205631529"></p>
<h3 id="Feature2ï¼šæŒ‰éœ€å†…å­˜åˆ†é…"><a href="#Feature2ï¼šæŒ‰éœ€å†…å­˜åˆ†é…" class="headerlink" title="Feature2ï¼šæŒ‰éœ€å†…å­˜åˆ†é…"></a>Feature2ï¼šæŒ‰éœ€å†…å­˜åˆ†é…</h3><h4 id="Design"><a href="#Design" class="headerlink" title="Design"></a>Design</h4><p>æ‰€æœ‰çš„å†…å­˜åˆ†é…è¯·æ±‚éƒ½ç”±å¶å­èŠ‚ç‚¹ OperatorPool å‘èµ·ï¼Œå‘ä¸Šä¼ é€’ä½¿ç”¨é‡ï¼Œ<strong>è‡ªåº•å‘ä¸Š</strong>ä¼ é€’åˆ° QueryMemoryPool</p>
<ol>
<li>ç”± QueryMemoryPool å¤„ç»Ÿä¸€æ¶ˆè€— MemoryManager çš„å†…å­˜ã€‚</li>
<li>QueryMemoryPool æœ‰å®¹é‡é™åˆ¶ï¼Œå¦‚æœå®¹é‡ä¸å¤Ÿï¼Œä¼šå‘ MemoryManager ç”³è¯·å†…å­˜</li>
<li>å…ˆè¿›è¡Œé€»è¾‘ç”³è¯·å†…å­˜ requestMemory æ“ä½œï¼Œå†è¿›è¡ŒçœŸå®ç‰©ç†åˆ†é… allocateã€‚request é€»è¾‘å®Œæˆåï¼ŒMemoryManager å’Œ Pool ä¸­çš„å„ç»Ÿè®¡ä¿¡æ¯å°±ä¼šå‘ç”Ÿæ”¹å˜ã€‚</li>
</ol>
<p>å¦‚æœ QueryMemoryPool çš„å†…å­˜è¶³å¤Ÿï¼Œä¼šè¿”å›åˆ†é…ç»“æœï¼Œåˆ†é…ç»“æœ<strong>è‡ªé¡¶å‘ä¸‹</strong>é€å±‚è¿”å›åˆ°å¶å­ç»“ç‚¹</p>
<ol>
<li><p>å¦‚æœ QueryMemoryPool çš„å†…å­˜ä¸å¤Ÿï¼Œä¼šå‘æ ¹èŠ‚ç‚¹ MemoryManager è¯·æ±‚ä¸€æ¬¡å†…å­˜ä»²è£</p>
</li>
<li><p>æ¯æ¬¡åˆ†é…çš„å†…å­˜é‡‡ç”¨ã€Œé¢„ç•™ã€ç­–ç•¥ï¼Œå€ŸåŠ©é‡åŒ–æœºåˆ¶ï¼Œå‡å°‘ç”³è¯·æ¬¡æ•°ã€‚å¦‚æœç”³è¯·çš„ sizeï¼š</p>
<ol>
<li><p>&lt; 16MBï¼ŒæŒ‰ç…§ 1MB çš„ç²’åº¦å‘ä¸Šå–æ•´</p>
</li>
<li><p>&lt; 64MBï¼ŒæŒ‰ç…§ 4MB çš„ç²’åº¦å‘ä¸Šå–æ•´</p>
</li>
<li><p>&gt;&#x3D; 64MBï¼ŒæŒ‰ç…§ 8MB çš„ç²’åº¦å‘ä¸Šå–æ•´</p>
</li>
</ol>
</li>
</ol>
<p>åœ¨æ¯ä¸ª MemoryPool ä¸­ï¼Œéƒ½æœ‰ä¸€ä¸ªå®¹é‡ï¼ˆcapacityï¼‰çš„æ¦‚å¿µï¼Œå³æ¯ä¸ªæ± çš„æœ€å¤§å®¹é‡æ˜¯å¤šå°‘ï¼Œå½“å‰å·²ç”³è¯·çš„å®¹é‡æ˜¯å¤šå°‘ï¼Œä»¥åŠå½“å‰æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹åœ¨æ ¹æ± ä¸­è·å–çš„ä¿ç•™å®¹é‡æ˜¯å¤šå°‘ã€‚</p>
<ol>
<li>ä¾‹å¦‚ï¼ŒæŸä¸ª leaf pool éœ€è¦ç”³è¯·æ–°çš„å†…å­˜ï¼Œå®ƒå°†ä»ç»¿è‰²éƒ¨åˆ†çš„å®¹é‡ä¸­è·å–ã€‚è‹¥æ­¤å®¹é‡ä¸è¶³ï¼Œåˆ™éœ€å¢é•¿å…¶å®¹é‡ä»¥å‘å³ç§»ã€‚å¦‚æœæ­¤æ—¶å…¨å±€å†…å­˜å®¹é‡è¿˜æ˜¯ä¸å¤Ÿï¼Œä¼šè§¦å‘å†…å­˜ä»²è£</li>
</ol>
<p>   <img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20241030174738768.png"></p>
<p>   å†…å­˜ä»²è£çš„ä¸»è¦èŒè´£æ˜¯ç®¡ç†æ‰€æœ‰ query çš„å¯ç”¨å®¹é‡ï¼Œå¹¶åœ¨æŸ¥è¯¢é—´è¿›è¡Œä»²è£ã€‚</p>
<ul>
<li>å†³å®šå°†å“ªä¸ªæŸ¥è¯¢ï¼Œæˆ–æŸ¥è¯¢ä¸­çš„å“ªä¸ªç®—å­é—²ç½®çš„å®¹é‡å½’è¿˜äºè¯¥æŸ¥è¯¢æˆ–ç®—å­</li>
<li>åˆæˆ–æ˜¯é€šè¿‡ spill æŠ€æœ¯ï¼Œå°†biæ“ä½œç¬¦ä¸­ä½¿ç”¨çš„å®¹é‡ï¼Œä½¿ç”¨çš„çŠ¶æ€æ•°æ®è¿›è¡Œæº¢å‡ºå¤„ç†åï¼Œå°†æº¢å‡ºçš„å®¹é‡è¿˜å›ç»™æŸ¥è¯¢ã€‚</li>
</ul>
<p>ä¸€æ¬¡å†…å­˜ä»²è£æ˜¯ç”±æŸæ¬¡å†…å­˜åˆ†é…è¯·æ±‚è§¦å‘çš„</p>
<ul>
<li>å¦‚æœå†…å­˜åˆ†é…è¯·æ±‚åˆ°è¾¾ QueryPool æ—¶å‘ç°å†…å­˜ä¸è¶³ï¼ŒMemoryManager ä¼šè§¦å‘ä¸€æ¬¡å†…å­˜ä»²è£</li>
<li>å†…å­˜ä»²è£<strong>æœ¬è´¨ä¸Šæ˜¯ä¸€æ¬¡å†…å­˜å›æ”¶ï¼Œå®ƒå°†å†³å®šå›æ”¶å“ªäº›æŸ¥è¯¢çš„å†…å­˜ï¼Œä»¥åŠæ€ä¹ˆå›æ”¶</strong></li>
<li>å‡è®¾å·²ç»é€‰å®šäº†å›æ”¶æŸä¸ª Query çš„å†…å­˜ï¼Œå†…å­˜å›æ”¶è¯·æ±‚ä¼š<strong>è‡ªé¡¶å‘ä¸‹</strong>ä¼ é€’ï¼Œç›´åˆ°å¶å­èŠ‚ç‚¹</li>
</ul>
<ol>
<li>LocalArbitration</li>
</ol>
<p>å‡è®¾ QueryA çš„ OperatorA è§¦å‘äº†ä¸€æ¬¡ä»²è£ï¼ŒLocal ç­–ç•¥åªä¼šå›æ”¶ QueryA å†…éƒ¨çš„å…¶ä»– Operator é—²ç½®å†…å­˜ã€‚</p>
<p>å¦‚ QueryA ä¸‹é¢çš„ OperatorA éœ€è¦å†…å­˜ï¼Œåˆ™ä¼šæŠŠ QueryA å†…é™¤äº† OperatorA çš„ free å†…å­˜éƒ½å›æ”¶æ‰ï¼Œåˆ†é…ç»™ OperatorA</p>
<ol start="2">
<li>GlobalArbitration</li>
</ol>
<p>å‡è®¾ QueryA è§¦å‘äº†ä¸€æ¬¡ä»²è£ï¼ŒLocal ç­–ç•¥ä¼šå°è¯•å›æ”¶å…¶ä»– Query çš„é—²ç½®å†…å­˜</p>
<ul>
<li>è¿‡ç¨‹åŒä¸Š</li>
<li>é€‰æ‹©é™¤äº† QueryA ä¹‹å¤–çš„æŸæ¬¡ Queryã€æ¯”å¦‚ QueryB è¿›è¡Œå›æ”¶<ul>
<li>é€‰æ‹©ç­–ç•¥ï¼šQuery æ ¹æ® free å†…å­˜å¤§å°è¿›è¡Œæ’åºï¼Œä¼šé€‰æ‹© free å†…å­˜æœ€å¤§çš„ Query è¿›è¡Œå›æ”¶</li>
<li>é»˜è®¤å›æ”¶ç­–ç•¥ï¼šåªå›æ”¶ free éƒ¨åˆ†çš„å†…å­˜</li>
</ul>
</li>
</ul>
<h3 id="Feature3ï¼š-å¹¶å‘å®‰å…¨ä¸-OOM-Handle-Strategy"><a href="#Feature3ï¼š-å¹¶å‘å®‰å…¨ä¸-OOM-Handle-Strategy" class="headerlink" title="Feature3ï¼š å¹¶å‘å®‰å…¨ä¸ OOM Handle Strategy"></a>Feature3ï¼š å¹¶å‘å®‰å…¨ä¸ OOM Handle Strategy</h3><h4 id="Designï¼š-1"><a href="#Designï¼š-1" class="headerlink" title="Designï¼š"></a>Designï¼š</h4><p>å¦‚æœæŸæ¬¡ Operator è¯·æ±‚åˆ†é…å†…å­˜ï¼Œ<strong>ç»è¿‡ä¸€æ¬¡å†…å­˜ä»²è£ä¹‹åä»ç„¶å†…å­˜ä¸å¤Ÿï¼ŒæŠ›å‡º</strong> <strong>OOM</strong> <strong>å¼‚å¸¸ï¼ˆè‡ªå·±å®šåˆ¶çš„ï¼‰ï¼Œä¸­æ–­æœ¬æ¬¡æŸ¥è¯¢ä»»åŠ¡ï¼ˆAbort è‡ªå·±ï¼‰</strong>ï¼Œé‡Šæ”¾æ‰€æœ‰å†…å­˜ã€‚</p>
<p><strong>è¦æ±‚ï¼šå¯¹äºåŒä¸€ä¸ª poolï¼Œå†…å­˜ä»²è£ã€å†…å­˜åˆ†é…ã€å†…å­˜å»é…ä¸‰è€…éƒ½æ˜¯ä¸²è¡Œï¼Œä¸å…è®¸ä¸¤ä¸¤å¹¶è¡Œã€‚</strong></p>
<ul>
<li>å†…å­˜ä»²è£æ—¶ä¸å…è®¸åˆ†é…æˆ–å»é…å†…å­˜ï¼Œå› ä¸ºå†…å­˜ä»²è£çš„è¿‡ç¨‹ä¸­è¦ä¿è¯ Pool çš„<strong>å†…å­˜çŠ¶æ€ä¸å¯å˜</strong>ã€‚å³å†…å­˜ä»²è£æ—¶éœ€è¦<strong>æš‚åœ</strong> <strong>Query</strong>ï¼ˆä¸å…è®¸åˆ†é…å†…å­˜ã€å»é…å†…å­˜ï¼‰<ul>
<li>è¯¥â€œæš‚åœâ€ä¸éœ€è¦çœŸæ­£çš„æš‚åœï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦å†…å­˜çŠ¶æ€ä¸å˜å³å¯ï¼Œä¸éœ€è¦æ‰§è¡ŒçŠ¶æ€ä¸å˜ã€‚</li>
<li>é€šè¿‡æ‰“æ ‡å¿—ä½å®ç°ï¼Œå‘ç”Ÿä»²è£åæ‰“ä¸Šæ ‡è®°ã€‚</li>
<li>è¯¥ pool å¦‚æœåç»­åœ¨ç”³è¯·å†…å­˜ã€é‡Šæ”¾å†…å­˜æ—¶å‘ç°æ‰“ä¸Šäº†æ ‡è®°ï¼Œä¼šåœ¨ condition waitï¼ˆå¦‚æ­¤èƒ½å®ç° query ä»»åŠ¡â€œæš‚åœâ€çš„æ•ˆæœï¼‰ã€‚ç›´åˆ°ä»²è£ç»“æŸåå”¤é†’ï¼ˆsignalï¼‰</li>
</ul>
</li>
<li>ç”³è¯·å†…å­˜æ—¶ï¼Œå’Œå†…å­˜ä»²è£å…±äº«ä¸€æŠŠé”ï¼Œä»¥ä¿è¯å†…å­˜ä»²è£å’Œå†…å­˜åˆ†é…æ˜¯ä¸²è¡Œçš„ï¼ˆä¸ä¼šå¹¶å‘ï¼‰</li>
<li>å†…å­˜æ± é‡Šæ”¾æ—¶ï¼Œä¸å…è®¸å’Œå…¶ä»–è¿‡ç¨‹å¹¶å‘ï¼ˆåˆ†é…ã€ä»²è£ï¼‰<ul>
<li>å»é…å†…å­˜æ—¶ï¼Œæ‰“ä¸Š closed æ ‡è®°ã€‚ä¸å…è®¸å…¶ä»–è¿‡ç¨‹ä¸ release å¹¶å‘è¿›è¡Œ</li>
</ul>
</li>
</ul>
<h4 id="Effectï¼š-1"><a href="#Effectï¼š-1" class="headerlink" title="Effectï¼š"></a>Effectï¼š</h4><p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20241031210033733.png" alt="image-20241031210033733"></p>
<h3 id="Feature4ï¼š-æ ¸å¿ƒæ•°æ®ç»“æ„å †å¤–æ”¹é€ "><a href="#Feature4ï¼š-æ ¸å¿ƒæ•°æ®ç»“æ„å †å¤–æ”¹é€ " class="headerlink" title="Feature4ï¼š æ ¸å¿ƒæ•°æ®ç»“æ„å †å¤–æ”¹é€ "></a>Feature4ï¼š æ ¸å¿ƒæ•°æ®ç»“æ„å †å¤–æ”¹é€ </h3><h4 id="Designï¼š-2"><a href="#Designï¼š-2" class="headerlink" title="Designï¼š"></a>Designï¼š</h4><p>   <strong>å¯å‘ï¼š</strong>è§‚å¯Ÿäº† dump å‡ºæ¥çš„æ–‡ä»¶ï¼Œå‘ç° 90%ä»¥ä¸Šçš„æŸ¥è¯¢å†…å­˜å ç”¨åœ¨ï¼šlabelã€propertyã€edge å’Œ vertex ä¸Šã€‚æŸ¥è¯¢è¿‡ç¨‹çš„<strong>å†…å­˜å ç”¨é›†ä¸­åœ¨å°‘æ•°ã€ä¸å¯å˜ã€æ‹¥æœ‰å¤§é‡å®ä¾‹çš„ class ä¸Š</strong></p>
<p>   å†…å®¹ï¼šä¸æŠŠæ•°æ®ç»“æ„å¯¹è±¡å…¨æ”¹é€ æˆå †å¤–çš„ï¼Œè¿˜æ˜¯è®©æ•°æ®ç»“æ„å¯¹è±¡ä¿æŒåœ¨å †å†…ï¼ŒåªæŠŠå…¶ä¸­å†…å­˜å ç”¨å¤§ã€ä¸å¯å˜çš„æŸäº›æˆå‘˜å˜é‡ï¼Œæ¯”å¦‚ labelï¼ˆæœ¬è´¨ä¸Šæ˜¯ä¸ª intï¼‰å­˜åœ¨å †å¤–ï¼Œç„¶åå†…å­˜ç®¡ç†æ¡†æ¶ç®¡ç†è¿™éƒ¨åˆ†å †å¤–å†…å­˜</p>
<ul>
<li>è¿™äº›ä¸å¯å˜çš„æˆå‘˜å˜é‡ç”¨å †å¤–ç®¡ç†æ–¹ä¾¿å®ç°<strong>é›¶æ‹·è´è¯»å†™</strong></li>
</ul>
<p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20241031210243918.png" alt="image-20241031210243918"></p>
<ol>
<li>æ‰¾å‡ºæ‰€æœ‰å¯ä»¥æ”¹é€ çš„ã€å†…å­˜å ç”¨å¤§ã€‘ä¸”ã€ä¸å¯å˜ã€‘å¯¹è±¡ï¼Œæä¾›ä»å †å¤–ç›´æ¥è®¿é—®è¯»å–çš„ <strong>API</strong></li>
</ol>
<ul>
<li>Object[]ï¼šä¸»è¦å†…å­˜å ç”¨æ¥è‡ªäº HugeEdge çš„ Listï¼Œåªè¦è§£å†³ HugeEdge çš„æ”¹é€ å³å¯</li>
<li>HugeVertexï¼šä¸»è¦å†…å­˜å ç”¨æ¥è‡ªäº HugeEdge çš„ Listï¼Œåªè¦è§£å†³ HugeEdge çš„æ”¹é€ å³å¯</li>
<li>HugeEdgeï¼š<ul>
<li>ä¸€éƒ¨åˆ†æ¥è‡ªäº id çš„å†…å­˜å ç”¨<ul>
<li>IdGenerator.Idï¼šå·²å®Œæˆæ”¹é€ </li>
</ul>
</li>
<li>ä¸€éƒ¨åˆ†æ¥è‡ªäº IntObjectMapï¼Œè¯¥éƒ¨åˆ†ä¸ºå¯å˜çš„ï¼Œæ— æ³•æ”¹é€ </li>
</ul>
</li>
<li>labelï¼šæœ¬è´¨ä¸Šå°±æ˜¯ Idï¼Œåªè¦å®Œæˆäº† Id çš„æ”¹é€ å³å¯</li>
<li>HugePropertyï¼šæœ¬è´¨ä¸Šæ˜¯ valueï¼Œå°† value å­˜åˆ°å †å¤–å³å¯</li>
</ul>
<p>   <strong>å®ç°ï¼š</strong> <a target="_blank" rel="noopener" href="https://github.com/apache/incubator-hugegraph/pull/2649/files#diff-50dacfc16cd10c17e66ac7254d7464b9c43218cd3a63f0b9a8782b149222c357">https://github.com/apache/incubator-hugegraph/pull/2649/files#diff-50dacfc16cd10c17e66ac7254d7464b9c43218cd3a63f0b9a8782b149222c357</a></p>
<ul>
<li>å®ç°äº† Factoryï¼Œä½¿ç”¨ Factory æ›¿æ¢æ‰€æœ‰ new ä¸Šè¿°å¯¹è±¡çš„åœ°æ–¹ã€‚</li>
<li>Factory çš„æ¥å£å’ŒåŸæ¥ new ä¿æŒä¸€è‡´ã€‚</li>
<li>Factory å†…éƒ¨æ ¹æ®ç”¨æˆ·è®¾ç½®çš„ memory_modeï¼Œé€‰æ‹©æ„é€ åŸæ¥çš„å †å†…ç‰ˆæœ¬å¯¹è±¡è¿˜æ˜¯æ„é€ å †å¤–å¯¹è±¡ã€‚</li>
</ul>
<h4 id="Effectï¼š-2"><a href="#Effectï¼š-2" class="headerlink" title="Effectï¼š   "></a>Effectï¼š   <img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20241030175040503.png" alt="image-20241030175040503"></h4>
  </div>
  
    
      <a id="older" class="blog-nav" href="/article/raft-rocksdb-in-hg/">OLDER&nbsp;&gt;</a>
      
        
          <a id="newer" class="blog-nav" href="/article/Blog-building-log/">&lt;&nbsp;NEWER</a>
          
            
</div>
        <div class="footer">
  
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/Pengzna">Copyright Â© Pengzna 2021-present</a>
        
    </div>
  
</div>

      </div>

      <div class="back-to-top hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



      
  <div class="search-icon" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-box">
        <div class="search-title">
          <!-- <span class="search-icon-input">
            <a href="javascript: void(0)">
              <i class="iconfont icon-search"></i>
            </a>
          </span> -->
          
            <input type="text" class="search-input" id="search-input" placeholder="æœç´¢">
          
          <span class="search-close-icon" id="search-close-icon">
            <a href="javascript: void(0)">
              <i class="iconfont icon-close"></i>
            </a>
          </span>
        </div>
        <div class="search-result" id="search-result"></div>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    // inputArea.onclick = function() {
    //   getSearchFile()
    //   this.onclick = null
    // }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        inputArea.focus()
        getSearchFile()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'><span></ul>";
      // $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'><h2>" + orig_data_title + "</h2></a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<h3 class=\"search-result-abstract\">" + match_content + "...</h3>"
                }
                str += "<hr></li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer toï¼š<a href='https://github.com/leedom92/hexo-theme-leedom#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




    </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </body>
</html>

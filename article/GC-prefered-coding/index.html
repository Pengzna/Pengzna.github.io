<!DOCTYPE html>
<html lang="en">

  <head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="Pengzna,blog" />
  <meta name="author" content="Pengzna" />
  <meta name="description" content="Pengzna çš„åšå®¢" />
  
  
  <title>
    
      GC è§†è§’ä¸‹çš„ä»£ç ä¼˜åŒ–â€”â€”å¦‚ä½•å†™å‡º&#34;GC å‹å¥½&#34;çš„ä»£ç  
      
      
    
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto:400,400italic,600|Roboto+Mono" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/css/common.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">


  

  
    
<link rel="stylesheet" href="/css/post.css">

  

  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


<meta name="generator" content="Hexo 7.0.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>


  <body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="app">
      <div class="header">
  <a href="/">Pengzna's blog ğŸ‘‹</a>
</div>


      <p class="links">
  
    <a title="archives" target="" href="/archives/">
      <i class="iconfont icon-bookmark"></i>
    </a>
  
    <a title="github" target="_blank" href="https://github.com/Pengzna">
      <i class="iconfont icon-github"></i>
    </a>
  
    <a title="email" target="_blank" href="mailto:junzhi.pengzna@gmail.com">
      <i class="iconfont icon-envelope"></i>
    </a>
  
    <a title="linkedin" target="_blank" href="https://www.linkedin.com/in/pengzna/">
      <i class="iconfont icon-linkedin"></i>
    </a>
  
    <a title="wechat" target="_blank" href="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20231115013033249.png">
      <i class="iconfont icon-wechat"></i>
    </a>
  
</p>


      <div class="main">
        <!-- æ–‡ç« è¯¦æƒ…é¡µï¼Œå±•ç¤ºæ–‡ç« å…·ä½“å†…å®¹ï¼Œurlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
<!-- åŒæ—¶ä¸ºã€Œæ ‡ç­¾tagã€ï¼Œã€Œæœ‹å‹friendã€ï¼Œã€Œåˆ†ç±»categoriesã€ï¼Œã€Œå…³äºaboutã€é¡µé¢çš„æ‰¿è½½é¡µé¢ï¼Œå…·ä½“å±•ç¤ºå–å†³äºpage.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
</script>

<div class="post">
  <h3 class="date">
    Mar 04, 2024
  </h3>
  <h1>
    GC è§†è§’ä¸‹çš„ä»£ç ä¼˜åŒ–â€”â€”å¦‚ä½•å†™å‡º"GC å‹å¥½"çš„ä»£ç 
  </h1>
  <div class="content markdown-body">
    <p>å¹¿ä¹‰ä¸Šçš„ GC è°ƒä¼˜ï¼Œé€šå¸¸æ˜¯æŒ‡é€šè¿‡ JVM options å‚æ•°è¿›è¡Œè°ƒä¼˜ã€‚ç„¶è€Œï¼Œé™¤äº†è°ƒå‚ï¼Œæˆ‘ä»¬æ›´åº”è¯¥æ³¨æ„ç»“åˆ GC çš„çŸ¥è¯†ï¼Œä»ä»£ç ä¸Šå°±å†™çš„å¯¹ GC å‹å¥½ï¼Œä»è€Œâ€æœªé›¨ç»¸ç¼ªâ€œï¼Œé˜²æ‚£äºæœªç„¶ã€‚å› æ­¤ï¼Œæ€»ç»“ä¸€äº›ä»£ç ç»éªŒååˆ†æœ‰å¿…è¦ã€‚</p>
<p>ç»“åˆç¬”è€…å‰æœŸå¯¹ GC çš„ç³»ç»Ÿè°ƒç ”ï¼Œä»¥åŠç¬”è€…å’Œ Apache IoTDB ç¤¾åŒºåŒå­¦çš„ä»£ç å®è·µï¼Œå‚è€ƒç½‘ç»œå¤§ç¥èµ„æ–™ï¼Œæ€»ç»“ä¸€äº› â€GC å‹å¥½â€œä»£ç  tipsã€‚</p>
<h2 id="å¤ç”¨å¯¹è±¡ï¼šæ± åŒ–"><a href="#å¤ç”¨å¯¹è±¡ï¼šæ± åŒ–" class="headerlink" title="å¤ç”¨å¯¹è±¡ï¼šæ± åŒ–"></a>å¤ç”¨å¯¹è±¡ï¼šæ± åŒ–</h2><p>ä¸ºäº†å‡å°‘å¯¹è±¡åˆ†é…å¼€é”€ï¼Œæé«˜æ€§èƒ½ã€åŒæ—¶å°½é‡å‡å°‘å¯¹è±¡çš„åˆ›å»ºé”€æ¯ï¼Œå‡å° GC å‹åŠ›ï¼Œå¯ä»¥é‡‡å–å¯¹è±¡æ± çš„æ–¹å¼æ¥ç¼“å­˜å¯¹è±¡é›†åˆï¼Œä½œä¸ºå¤ç”¨çš„æ‰‹æ®µã€‚</p>
<p><strong>ä½†æ˜¯æ— è„‘æ± åŒ–ï¼Œå¯èƒ½æ•ˆæœæœ‰é™ï¼Œå› ä¸ºï¼š</strong></p>
<ol>
<li>å¯¹äºå¯¹è±¡æœ¬èº«ï¼š</li>
</ol>
<blockquote>
<p>å¦‚æœå¯¹è±¡å¾ˆå°ï¼Œé‚£ä¹ˆåˆ†é…çš„å¼€é”€æœ¬æ¥å°±å°ï¼Œå¯¹è±¡æ± åªä¼šå¢åŠ ä»£ç å¤æ‚åº¦ã€‚</p>
<p>å¦‚æœå¯¹è±¡æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆæ™‹å‡åˆ° Old Generation åï¼Œå¯¹ GC çš„å‹åŠ›å°±æ›´å¤§äº†ã€‚</p>
</blockquote>
<ol>
<li>ä»çº¿ç¨‹å®‰å…¨çš„è§’åº¦è€ƒè™‘ï¼Œé€šå¸¸æ± éƒ½æ˜¯ä¼šè¢«å¹¶å‘è®¿é—®çš„ï¼Œé‚£ä¹ˆåŒæ­¥å¸¦æ¥çš„å¼€é”€ï¼Œæœªå¿…æ¯”é‡æ–°åˆ›å»ºä¸€ä¸ªå¯¹è±¡å°ã€‚ï¼ˆé™¤éæ± æœ¬èº«çš„å®ç°å¾ˆä¼˜ç§€ï¼Œæ¯”å¦‚é€šè¿‡ CAS ç­‰æ‰‹æ®µå°½å¯èƒ½å‡å°äº†åŒæ­¥å¼€é”€ï¼‰</li>
<li>å¯¹è±¡æ± ä¸­çš„å¯¹è±¡ç”±äºåœ¨è¿è¡ŒæœŸé•¿æœŸå­˜æ´»ï¼Œå¤§éƒ¨åˆ†ä¼šæ™‹å‡åˆ° Old Generationï¼Œå› æ­¤æ— æ³•é€šè¿‡ YoungGC å›æ”¶ã€‚</li>
</ol>
<p><strong>å› æ­¤å¯¹äºæ± åŒ–ï¼Œéœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š</strong></p>
<ol>
<li>åˆé€‚çš„åœºæ™¯æ‰æ± åŒ–ï¼šå³<strong>å½“æ± ä¸­çš„æ¯ä¸ªå¯¹è±¡çš„åˆ›å»ºã€å›æ”¶å¼€é”€è¾ƒå¤§</strong>æ—¶ï¼Œç¼“å­˜å¤ç”¨æ‰æœ‰æ„ä¹‰ï¼Œä¾‹å¦‚æ¯æ¬¡ new éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œæˆ–æ˜¯ä¾èµ–ä¸€æ¬¡ RPCã€‚<ol>
<li>å¦‚çº¿ç¨‹æ± ã€RPC client æ± ã€TCP è¿æ¥æ± ã€æ•°æ®åº“ session æ± ç­‰</li>
</ol>
</li>
<li>æœ€å¥½å¼•å…¥å®šæ—¶å¯¹è±¡æ¸…ç†ï¼ˆKeepAliveTimeï¼‰æœºåˆ¶ï¼šæ¸…ç†æ± å­ä¸­é•¿æ—¶é—´ä¸ç”¨çš„é•¿æ´»å¯¹è±¡ï¼Œé‡Šæ”¾èµ„æºã€‚å¦åˆ™å¯èƒ½å¯¼è‡´è€å¹´ä»£ç©ºé—´è¢«å †ç§¯å ç”¨ã€‚</li>
</ol>
<blockquote>
<p>IoTDB åœ¨ clientManager å·²ç»å¯¹æ± åŒ–å¯¹è±¡çš„å®šæ—¶æ¸…ç†æœ‰è¿‡å®è·µï¼šä½¿ç”¨ <code>org.apache.commons.pool2</code> çš„ <code>KeyedObjectPool</code>ï¼Œå¹¶è®¾ç½®å®šæ—¶é©±é€å‚æ•°å³å¯ã€‚</p>
<p>JDK åŸç”Ÿçš„çº¿ç¨‹æ± ä¹‹æ‰€ä»¥å¼•å…¥ KeepLiveTime å®šæ—¶æ¸…ç†é—²ç½®çº¿ç¨‹ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚</p>
</blockquote>
<p><strong>æ¡ˆä¾‹</strong>ï¼šIoTDB ç¤¾åŒºåŒå­¦å¯¹å¤§ Text å†™å…¥åœºæ™¯çš„ Byte[] å¯¹è±¡è¿›è¡Œäº†æ± åŒ–ï¼Œè·å¾—äº†è¾ƒå¥½çš„æ”¶ç›Šã€‚</p>
<h2 id="å–„ç”¨å„ç±»å¼•ç”¨"><a href="#å–„ç”¨å„ç±»å¼•ç”¨" class="headerlink" title="å–„ç”¨å„ç±»å¼•ç”¨"></a>å–„ç”¨å„ç±»å¼•ç”¨</h2><p><code>java.lang.ref.Reference</code>æœ‰å‡ ä¸ªå­ç±»ï¼Œç”¨äºå¤„ç†å’Œ GC ç›¸å…³çš„å¼•ç”¨ã€‚JVM çš„å¼•ç”¨ç±»å‹ç®€å•æ¥è¯´æœ‰å‡ ç§ï¼š</p>
<ul>
<li><p><strong>Strong Reference</strong>ï¼Œåªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼ŒGC å°†æ°¸è¿œä¸ä¼šå›æ”¶è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œå“ªæ€•å†…å­˜ä¸è¶³æ—¶ï¼ŒJVM ä¹Ÿä¼šç›´æ¥æŠ›å‡º <code>OutOfMemoryError</code>ï¼Œä¸ä¼šå»å›æ”¶ã€‚å¦‚æœæƒ³ä¸­æ–­å¼ºå¼•ç”¨ä¸å¯¹è±¡ä¹‹é—´çš„è”ç³»ï¼Œå¯ä»¥æ˜¾å¼çš„å°†å¼ºå¼•ç”¨èµ‹å€¼ä¸º nullã€‚</p>
</li>
<li><p><strong>Soft Reference</strong>ï¼Œåœ¨å†…å­˜è¶³å¤Ÿçš„æ—¶å€™ï¼Œè½¯å¼•ç”¨å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ï¼Œåªå½“ä¸´è¿‘ OOM æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šå›æ”¶è½¯å¼•ç”¨å¯¹è±¡ï¼Œå¦‚æœå›æ”¶äº†è½¯å¼•ç”¨å¯¹è±¡ä¹‹åä»ç„¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºOutOfMemoryErrorã€‚<strong>è¿™ç§ç‰¹æ€§å¸¸å¸¸è¢«ç”¨æ¥å®ç°ç¼“å­˜</strong>ã€‚</p>
</li>
<li><p><strong>Weak Reference</strong>ï¼Œæ— è®ºå†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œåªè¦ JVM å¼€å§‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œé‚£äº›è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡éƒ½ä¼šè¢«å›æ”¶ã€‚</p>
</li>
</ul>
<blockquote>
<p>åœ¨ Java é›†åˆä¸­æœ‰ä¸€ç§ç‰¹æ®Šçš„ Map ç±»å‹ï¼šWeakHashMapï¼Œ åœ¨è¿™ç§ Map ä¸­å­˜æ”¾äº†é”®å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œå½“ä¸€ä¸ªé”®å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆç›¸åº”çš„å€¼å¯¹è±¡çš„å¼•ç”¨ä¼šä» Map ä¸­åˆ é™¤ã€‚WeakHashMap èƒ½å¤ŸèŠ‚çº¦å­˜å‚¨ç©ºé—´ï¼Œå¯ç”¨æ¥ç¼“å­˜é‚£äº›éå¿…é¡»å­˜åœ¨çš„æ•°æ®ã€‚</p>
<p>å½“å®ç°ç¼“å­˜æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä¼˜å…ˆä½¿ç”¨<code>WeakHashMap</code>ï¼Œè€Œä¸æ˜¯<code>HashMap</code>ï¼Œå½“ç„¶ï¼Œæ›´å¥½çš„é€‰æ‹©æ˜¯ä½¿ç”¨æ¡†æ¶ï¼Œä¾‹å¦‚ Guava Cacheã€‚</p>
</blockquote>
<ul>
<li><strong>Phantom Reference</strong>ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œå®ƒéšæ—¶å¯èƒ½ä¼šè¢«å›æ”¶ã€‚ä¸»è¦ç”¨äºè¯†åˆ«å¯¹è±¡è¢« GC çš„æ—¶æœºï¼Œé€šå¸¸ç”¨äºåšä¸€äº›æ¸…ç†å·¥ä½œï¼Œå®é™…ä»£ç å¼€å‘ç”¨çš„ä¸å¤š</li>
</ul>
<p>ä»¥ä¸Šçš„è¿™äº›æœªå¿…å¯ä»¥å¯¹ä»£ç æœ‰å¤šå°‘æ€§èƒ½ä¸Šçš„æå‡ï¼Œä½†æ˜¯ç†Ÿæ‚‰è¿™äº›æ–¹æ³•ï¼Œæ˜¯ä¸ºäº†å¸®åŠ©æˆ‘ä»¬å†™å‡ºæ›´å“è¶Šçš„ä»£ç ï¼Œå’Œ GC æ›´å¥½åœ°åˆä½œã€‚</p>
<h2 id="æŒ‡å®šå®¹å™¨åˆå§‹åŒ–å¤§å°"><a href="#æŒ‡å®šå®¹å™¨åˆå§‹åŒ–å¤§å°" class="headerlink" title="æŒ‡å®šå®¹å™¨åˆå§‹åŒ–å¤§å°"></a>æŒ‡å®šå®¹å™¨åˆå§‹åŒ–å¤§å°</h2><p>Java å®¹å™¨çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬éƒ½ä¸ä¼šå»è€ƒè™‘åˆå§‹å¤§å°çš„è®¾ç½®ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨æ‰©å®¹ã€‚</p>
<p>ä½†æ˜¯æ‰©å®¹æ„å‘³ç€ä»£ä»·ï¼Œä¾‹å¦‚ä¸€äº›åŸºäºæ•°ç»„çš„æ•°æ®ç»“æ„ï¼š<code>StringBuilder</code>ã€<code>StringBuffer</code>ã€<code>ArrayList</code>ã€<code>HashMap</code>ç­‰ï¼Œåœ¨æ‰©å®¹çš„æ—¶å€™éƒ½éœ€è¦åš ArrayCopyï¼Œå¯¹äºä¸æ–­å¢é•¿çš„ç»“æ„æ¥è¯´ï¼Œç»è¿‡è‹¥å¹²æ¬¡æ‰©å®¹ï¼Œä¼šå­˜åœ¨å¤§é‡æ— ç”¨çš„è€æ•°ç»„ï¼Œè€Œå›æ”¶è¿™äº›æ•°ç»„çš„å‹åŠ›ï¼Œå…¨éƒ½ä¼šåŠ åœ¨ GC èº«ä¸Šã€‚</p>
<p>è¿™äº›å®¹å™¨çš„æ„é€ å‡½æ•°ä¸­é€šå¸¸éƒ½æœ‰ä¸€ä¸ªå¯ä»¥æŒ‡å®šå¤§å°çš„å‚æ•°ï¼Œ<strong>å¦‚æœå¯¹äºæŸäº›å¤§å°å¯ä»¥é¢„ä¼°çš„å®¹å™¨ï¼Œå»ºè®®åŠ ä¸Šè¿™ä¸ªå‚æ•°ã€‚</strong></p>
<blockquote>
<p>å¦‚æœé‡‡ç”¨é»˜è®¤æ— å‚æ„é€ å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ª ArrayListï¼Œä¸æ–­å¢åŠ å…ƒç´ ç›´åˆ° OOMï¼Œé‚£ä¹ˆåœ¨æ­¤è¿‡ç¨‹ä¸­ä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>å¤šæ¬¡æ•°ç»„æ‰©å®¹ï¼Œé‡æ–°åˆ†é…æ›´å¤§ç©ºé—´çš„æ•°ç»„</li>
<li>å¤šæ¬¡æ•°ç»„æ‹·è´</li>
<li>å†…å­˜ç¢ç‰‡ï¼ˆå‹åŠ›ä¼šæœ€ç»ˆç»™åˆ° GCï¼‰</li>
</ul>
</blockquote>
<h2 id="æ‰‹åŠ¨æŠŠå¯¹è±¡ç½®-nullï¼Ÿ"><a href="#æ‰‹åŠ¨æŠŠå¯¹è±¡ç½®-nullï¼Ÿ" class="headerlink" title="æ‰‹åŠ¨æŠŠå¯¹è±¡ç½® nullï¼Ÿ"></a>æ‰‹åŠ¨æŠŠå¯¹è±¡ç½® nullï¼Ÿ</h2><p><strong>å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ²¡æœ‰ä½œç”¨</strong>ï¼ŒJVM ä¼šå¸®æˆ‘ä»¬åˆ†æå‡ºä¸å¯è¾¾çš„å¯¹è±¡å¹¶è‡ªåŠ¨å›æ”¶ï¼ŒJIT Compiler ä¼šè‡ªåŠ¨åˆ†æ local å˜é‡çš„ç”Ÿå‘½å‘¨æœŸã€‚æ­¤ä¸¾ä½¿å¾—ä»£ç çš„å¯è¯»æ€§ä¸‹é™äº†ä¸å°‘ã€‚</p>
<p><strong>ä»¥ä¸‹å‡ ç§æœ‰é™çš„æƒ…å†µå¯èƒ½éœ€è¦æ‰‹åŠ¨å¤„ç†ï¼š</strong></p>
<ol>
<li>æŸä¸ªå·¨å¤§çš„å¸¸é©»å†…å­˜çš„é›†åˆç¼“å­˜å¯¹è±¡ï¼Œé‡Œé¢æŸäº›æ•°æ®åœ¨ä¸šåŠ¡å®Œæˆåå¿…é¡»è¦æ‰‹åŠ¨é‡Šæ”¾ï¼Œå¦åˆ™è¯¥é›†åˆå¯¹è±¡å¯èƒ½ä¼šè¶Šæ¥è¶Šå¤§ã€‚</li>
<li>æŸä¸ªå¯¹è±¡ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ï¼Œæ¯”å¦‚å®ƒåœ¨ä¸€ä¸ªå·¨å¤§çš„æ–¹æ³•ä½“å†…ï¼Œæˆ–å®ƒæ¨ªè·¨äº†å¤šä¸ªæ–¹æ³•çš„è°ƒç”¨æ ˆï¼Œè¢«ä¸€ç›´å¼•ç”¨ï¼Œåœ¨ä¸šåŠ¡ä¸éœ€è¦çš„æ—¶å€™å°†å…¶å¼•ç”¨åŠæ—¶ç½®ä¸º nullï¼Œå¯ä»¥å¸®åŠ© GC æå‰é‡Šæ”¾æ‰è¯¥å¯¹è±¡çš„å†…å­˜ã€‚åœ¨å†…å­˜å ç”¨è¾¾åˆ°ç“¶é¢ˆæ—¶å¯ä»¥ä¼˜åŒ– GCã€‚</li>
</ol>
<p><strong>æ¡ˆä¾‹ï¼š</strong>åœ¨ IoTDB çš„ InsertRecord æ¥å£é‡Œï¼Œå¯¹ request é‡Œä¸šåŠ¡ä¸éœ€è¦çš„åºåˆ—åŒ–æ•°æ®æå‰ç½® nullï¼Œè®© GC æå‰é‡Šæ”¾è¿™éƒ¨åˆ†å†…å­˜ï¼Œæœ‰åŠ©äºé™ä½å†…å­˜å ç”¨çš„å³°å€¼ï¼Œåœ¨å†…å­˜æ¯”è¾ƒç´§å¼ çš„æç«¯ç“¶é¢ˆåœºæ™¯ä¸‹ï¼ˆGC time å æ¯” 30%+ï¼‰æœ‰æ•ˆå‡è½»äº† GC å‹åŠ›</p>
<h2 id="å¼‚å¸¸æ—¶åœ¨-cath-æˆ–-finally-å›æ”¶èµ„æº"><a href="#å¼‚å¸¸æ—¶åœ¨-cath-æˆ–-finally-å›æ”¶èµ„æº" class="headerlink" title="å¼‚å¸¸æ—¶åœ¨ cath{} æˆ– finally{} å›æ”¶èµ„æº"></a>å¼‚å¸¸æ—¶åœ¨ cath{} æˆ– finally{} å›æ”¶èµ„æº</h2><p>å¼‚å¸¸å¤„ç†çš„ catch æ¨¡å—æˆ–è€… finally æ¨¡å—ä¸­èµ„æºé‡Šæ”¾çš„ä»£ç æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœå¼‚å¸¸æ—¶æ²¡æœ‰åœ¨ catch{} æˆ– finally{} ä¸­é‡Šæ”¾æŸäº›èµ„æºï¼ˆå¦‚ close æ–‡ä»¶ç­‰ï¼‰ï¼Œå¯èƒ½ä¼šé€ æˆå¯¹è±¡èµ„æºçš„é•¿æœŸå ç”¨ã€‚</p>
<h2 id="ä¸è¦æ‰‹åŠ¨æŒ¡ï¼šSystem-gc-ä»¥åŠ-finalize"><a href="#ä¸è¦æ‰‹åŠ¨æŒ¡ï¼šSystem-gc-ä»¥åŠ-finalize" class="headerlink" title="ä¸è¦æ‰‹åŠ¨æŒ¡ï¼šSystem.gc() ä»¥åŠ finalize()"></a>ä¸è¦æ‰‹åŠ¨æŒ¡ï¼šSystem.gc() ä»¥åŠ finalize()</h2><p>åœ¨æŸäº›é«˜çº§ç»„ä»¶çš„é«˜çº§åŠŸèƒ½ä¸­å¯èƒ½ä¼šè°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå¹³æ—¶æˆ‘ä»¬çš„ç¼–ç ä¸­åŸºæœ¬ä¸Šç”¨ä¸ä¸Šï¼Œæ‰€ä»¥è¿˜æ˜¯è®© JVM è‡ªå·±å»å¤„ç†å§ã€‚</p>
<ol>
<li>System.gc() ä¼šè§¦å‘ FGCï¼Œç›¸å½“äºè‡ªæ€ã€‚</li>
<li>é‡å†™ finalize() çš„å¯¹è±¡ä¸ä¼šè¢«  GC å›æ”¶ï¼Œç›´åˆ° finalize() è¢«æ‰§è¡Œï¼Œå³ä½¿å®ƒå·²ç»æˆä¸ºã€Œåƒåœ¾å¯¹è±¡ã€ã€‚å› æ­¤ finalize() ä¸å–„ç”¨çš„è¯å®¹æ˜“äº§ç”Ÿå¯¹è±¡å †ç§¯ã€‚</li>
</ol>
<blockquote>
<p>NOTEï¼šé™¤éæ˜¯åœ¨å¯¹ä»£ç éå¸¸ç†Ÿæ‚‰çš„æƒ…å†µä¸‹ï¼Œæ‰‹åŠ¨ System.gc æ¥é‡Šæ”¾å †å¤–å†…å­˜ï¼Œå¦åˆ™å¹³æ—¶ä¸å»ºè®®æ‰‹åŠ¨ System.gc</p>
</blockquote>
<h2 id="ç¼©å°å¯¹è±¡ä½œç”¨åŸŸ"><a href="#ç¼©å°å¯¹è±¡ä½œç”¨åŸŸ" class="headerlink" title="ç¼©å°å¯¹è±¡ä½œç”¨åŸŸ"></a>ç¼©å°å¯¹è±¡ä½œç”¨åŸŸ</h2><p>å°½å¯èƒ½ç¼©å°å¯¹è±¡çš„ä½œç”¨åŸŸï¼Œå³ç”Ÿå‘½å‘¨æœŸã€‚</p>
<blockquote>
<p>å¦‚æœå¯ä»¥åœ¨æ–¹æ³•å†…å£°æ˜çš„å±€éƒ¨å˜é‡ï¼Œå°±ä¸è¦å£°æ˜ä¸ºå®ä¾‹å˜é‡ã€‚</p>
<p>é™¤éä½ çš„å¯¹è±¡æ˜¯å•ä¾‹çš„æˆ–ä¸å˜çš„ï¼Œå¦åˆ™å°½å¯èƒ½å°‘åœ°å£°æ˜ static å˜é‡ã€‚</p>
</blockquote>

  </div>
  
    
      <a id="older" class="blog-nav" href="/article/JVM-GC-Tuning/">OLDER&nbsp;&gt;</a>
      
        
          <a id="newer" class="blog-nav" href="/article/JVM-biased-lock/">&lt;&nbsp;NEWER</a>
          
            
</div>
        <div class="footer">
  
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/Pengzna">Copyright Â© Pengzna 2021-present</a>
        
    </div>
  
</div>

      </div>

      <div class="back-to-top hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



      
  <div class="search-icon" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-box">
        <div class="search-title">
          <!-- <span class="search-icon-input">
            <a href="javascript: void(0)">
              <i class="iconfont icon-search"></i>
            </a>
          </span> -->
          
            <input type="text" class="search-input" id="search-input" placeholder="æœç´¢">
          
          <span class="search-close-icon" id="search-close-icon">
            <a href="javascript: void(0)">
              <i class="iconfont icon-close"></i>
            </a>
          </span>
        </div>
        <div class="search-result" id="search-result"></div>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    // inputArea.onclick = function() {
    //   getSearchFile()
    //   this.onclick = null
    // }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        inputArea.focus()
        getSearchFile()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'><span></ul>";
      // $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'><h2>" + orig_data_title + "</h2></a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<h3 class=\"search-result-abstract\">" + match_content + "...</h3>"
                }
                str += "<hr></li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer toï¼š<a href='https://github.com/leedom92/hexo-theme-leedom#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




    </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </body>
</html>

<!DOCTYPE html>
<html lang="en">

  <head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="Pengzna,blog" />
  <meta name="author" content="Pengzna" />
  <meta name="description" content="Pengzna çš„åšå®¢" />
  
  
  <title>
    
      Spring å­¦ä¹ -1 
      
      
    
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto:400,400italic,600|Roboto+Mono" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/css/common.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">


  

  
    
<link rel="stylesheet" href="/css/post.css">

  

  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


<meta name="generator" content="Hexo 7.0.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>


  <body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="app">
      <div class="header">
  <a href="/">Pengzna's blog ğŸ‘‹</a>
</div>


      <p class="links">
  
    <a title="archives" target="" href="/archives/">
      <i class="iconfont icon-bookmark"></i>
    </a>
  
    <a title="github" target="_blank" href="https://github.com/Pengzna">
      <i class="iconfont icon-github"></i>
    </a>
  
    <a title="email" target="" href="">
      <i class="iconfont icon-envelope"></i>
    </a>
  
    <a title="linkedin" target="_blank" href="https://www.linkedin.com/in/pengzna/">
      <i class="iconfont icon-linkedin"></i>
    </a>
  
    <a title="wechat" target="_blank" href="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20231115013033249.png">
      <i class="iconfont icon-wechat"></i>
    </a>
  
</p>


      <div class="main">
        <!-- æ–‡ç« è¯¦æƒ…é¡µï¼Œå±•ç¤ºæ–‡ç« å…·ä½“å†…å®¹ï¼Œurlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
<!-- åŒæ—¶ä¸ºã€Œæ ‡ç­¾tagã€ï¼Œã€Œæœ‹å‹friendã€ï¼Œã€Œåˆ†ç±»categoriesã€ï¼Œã€Œå…³äºaboutã€é¡µé¢çš„æ‰¿è½½é¡µé¢ï¼Œå…·ä½“å±•ç¤ºå–å†³äºpage.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
</script>

<div class="post">
  <h3 class="date">
    Jul 25, 2022
  </h3>
  <h1>
    Spring å­¦ä¹ -1
  </h1>
  <div class="content markdown-body">
    <h2 id="1-1-Spring-IoC-Container-Bean"><a href="#1-1-Spring-IoC-Container-Bean" class="headerlink" title="1.1. Spring IoC Container &amp; Bean"></a>1.1. Spring IoC Container &amp; Bean</h2><blockquote>
<p>IoC ä¹Ÿæˆä¸ºä¾èµ–æ³¨å…¥ï¼Œæ˜¯å¯¹è±¡ä»…é€šè¿‡<strong>*æ„é€ å‡½æ•°å‚æ•°ã€å·¥å‚æ–¹æ³•çš„å‚æ•° æˆ–åœ¨å¯¹è±¡å®ä¾‹è¢«æ„é€  æˆ–ä»å·¥å‚æ–¹æ³•è¿”å›ååœ¨å¯¹è±¡å®ä¾‹ä¸Šè®¾ç½®çš„å±æ€§æ¥å®šä¹‰å®ƒä»¬çš„ä¾èµ–é¡¹</strong>ã€‚*</p>
</blockquote>
<ul>
<li>å®¹å™¨åœ¨åˆ›å»º Bean æ—¶æ³¨å…¥è¿™äº›ä¾èµ–æ€§ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ Bean æœ¬èº«çš„é€†è¿‡ç¨‹ï¼Œå› æ­¤å¾—åæ§åˆ¶åè½¬<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_36817189/article/details/123410280">(26 æ¡æ¶ˆæ¯) æµ…è°ˆæ§åˆ¶åè½¬ï¼ˆIoCï¼‰<em>ç±³ç¢å¸ˆå…„çš„åšå®¢-CSDN åšå®¢</em>æ§åˆ¶åè½¬</a></li>
</ul>
</li>
<li>åœ¨ Spring ä¸­ï¼Œæ„æˆåº”ç”¨ç¨‹åºä¸»å¹²å¹¶ç”± Spring IoC å®¹å™¨ç®¡ç†çš„å¯¹è±¡ç§°ä¸º beanã€‚</li>
<li>bean æ˜¯ç”± Spring IoC å®¹å™¨å®ä¾‹åŒ–ã€ç»„è£…å’Œç®¡ç†çš„å¯¹è±¡ã€‚ å¦åˆ™ï¼Œbean åªæ˜¯åº”ç”¨ç¨‹åºä¸­ä¼—å¤šå¯¹è±¡ä¹‹ä¸€ã€‚ Bean ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»åæ˜ åœ¨å®¹å™¨ä½¿ç”¨çš„é…ç½®å…ƒæ•°æ®ä¸­ã€‚</li>
</ul>
<h2 id="1-2-å®¹å™¨æ¦‚è¿°"><a href="#1-2-å®¹å™¨æ¦‚è¿°" class="headerlink" title="1.2. å®¹å™¨æ¦‚è¿°"></a>1.2. å®¹å™¨æ¦‚è¿°</h2><blockquote>
<p><code>org.springframework.context.ApplicationContext</code> æ¥å£ä»£è¡¨ Spring IoC å®¹å™¨ï¼Œè´Ÿè´£å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£… beanã€‚ å®¹å™¨é€šè¿‡è¯»å–é…ç½®å…ƒæ•°æ®æ¥è·å–æœ‰å…³è¦å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…å“ªäº›å¯¹è±¡çš„æŒ‡ä»¤ã€‚ é…ç½®å…ƒæ•°æ®ä»¥ XMLã€**<em>Java æ³¨è§£</em>**æˆ– Java ä»£ç è¡¨ç¤ºã€‚ å®ƒå¯ä»¥è®©æ‚¨è¡¨è¾¾ç»„æˆåº”ç”¨ç¨‹åºçš„å¯¹è±¡ä»¥åŠè¿™äº›å¯¹è±¡ä¹‹é—´ä¸°å¯Œçš„ç›¸äº’ä¾èµ–å…³ç³»ã€‚</p>
</blockquote>
<ul>
<li>ä¸€èˆ¬æ¥è¯´ï¼Œåˆ›å»ºå¹¶åˆå§‹åŒ–äº†<code>ApplicationContext</code>åï¼Œå°±æœ‰äº†ä¸€ä¸ªå®Œå…¨é…ç½®ä¸”å¯æ‰§è¡Œçš„ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åº</li>
</ul>
<h3 id="1-2-1-é…ç½®å…ƒæ•°æ®"><a href="#1-2-1-é…ç½®å…ƒæ•°æ®" class="headerlink" title="1.2.1. é…ç½®å…ƒæ•°æ®"></a>1.2.1. é…ç½®å…ƒæ•°æ®</h3><p>æ–¹å¼ä¸»è¦æœ‰ä¸‰</p>
<ul>
<li>åŸºäº XMLï¼ˆåŸºæœ¬ç”¨ä¸åˆ°ï¼Œä¸è¯¦è¿°ï¼‰</li>
<li>åŸºäºæ³¨è§£ï¼ˆåæ–‡æåˆ°ï¼‰</li>
<li>åŸºäº Javaï¼ˆåæ–‡æåˆ°ï¼‰</li>
</ul>
<h3 id="1-2-2-å®ä¾‹åŒ–å®¹å™¨"><a href="#1-2-2-å®ä¾‹åŒ–å®¹å™¨" class="headerlink" title="1.2.2. å®ä¾‹åŒ–å®¹å™¨"></a>1.2.2. å®ä¾‹åŒ–å®¹å™¨</h3><ul>
<li>Spring çš„å®ä¾‹åŒ–ç”¨çš„æ¯”è¾ƒå°‘äº†ï¼Œç•¥</li>
</ul>
<h3 id="1-2-3-ä½¿ç”¨å®¹å™¨"><a href="#1-2-3-ä½¿ç”¨å®¹å™¨" class="headerlink" title="1.2.3. ä½¿ç”¨å®¹å™¨"></a>1.2.3. ä½¿ç”¨å®¹å™¨</h3><ul>
<li>Spring çš„å®ä¾‹åŒ–ç”¨çš„æ¯”è¾ƒå°‘äº†ï¼Œç•¥</li>
</ul>
<h2 id="1-3-Bean-æ¦‚è¿°"><a href="#1-3-Bean-æ¦‚è¿°" class="headerlink" title="1.3. Bean æ¦‚è¿°"></a>1.3. Bean æ¦‚è¿°</h2><ul>
<li>ç•¥</li>
</ul>
<h2 id="1-4-ä¾èµ–å…³ç³»"><a href="#1-4-ä¾èµ–å…³ç³»" class="headerlink" title="1.4. ä¾èµ–å…³ç³»"></a>1.4. ä¾èµ–å…³ç³»</h2><h3 id="1-4-1-ä¾èµ–æ³¨å…¥"><a href="#1-4-1-ä¾èµ–æ³¨å…¥" class="headerlink" title="1.4.1. ä¾èµ–æ³¨å…¥"></a>1.4.1. ä¾èµ–æ³¨å…¥</h3><ul>
<li>åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥<ul>
<li>åŸºäºæ„é€ å‡½æ•°çš„ DI æ˜¯é€šè¿‡å®¹å™¨è°ƒç”¨å…·æœ‰å¤šä¸ªå‚æ•°çš„æ„é€ å‡½æ•°æ¥å®Œæˆçš„ï¼Œæ¯ä¸ªå‚æ•°ä»£è¡¨ä¸€ä¸ªä¾èµ–é¡¹ã€‚ è°ƒç”¨å¸¦æœ‰ç‰¹å®šå‚æ•°çš„ <code>static</code> å·¥å‚æ–¹æ³•æ¥æ„é€  bean å‡ ä¹æ˜¯ç­‰æ•ˆçš„ï¼Œæœ¬è®¨è®ºå°†ç±»ä¼¼åœ°å¤„ç†æ„é€ å‡½æ•°å’Œ <code>static</code> å·¥å‚æ–¹æ³•çš„å‚æ•°ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªåªèƒ½ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥è¿›è¡Œä¾èµ–æ³¨å…¥çš„ç±»</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// the SimpleMovieLister has a dependency on a MovieFinder</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a constructor so that the Spring container can inject a MovieFinder</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SimpleMovieLister</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// business logic that actually uses the injected MovieFinder is omitted...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpringBoot ä¸­å¤šç”¨æ³¨è§£ç»“åˆæ„é€ å‡½æ•°è¿›è¡Œ DI</p>
<ul>
<li>æ„é€ å‡½æ•°å‚æ•°è§£æ<ul>
<li>æ„é€ å‡½æ•°å‚æ•°è§£æåŒ¹é…é€šè¿‡ä½¿ç”¨å‚æ•°çš„ç±»å‹å‘ç”Ÿã€‚ å¦‚æœ bean å®šä¹‰çš„æ„é€ å‡½æ•°å‚æ•°ä¸­ä¸å­˜åœ¨æ½œåœ¨çš„æ­§ä¹‰ï¼Œé‚£ä¹ˆåœ¨ bean å®šä¹‰ä¸­å®šä¹‰æ„é€ å‡½æ•°å‚æ•°çš„é¡ºåºå°±æ˜¯åœ¨å®ä¾‹åŒ– bean æ—¶å°†è¿™äº›å‚æ•°æä¾›ç»™é€‚å½“çš„æ„é€ å‡½æ•°çš„é¡ºåºã€‚</li>
</ul>
</li>
<li>Spring ä¸­æ„é€ å‡½æ•°æ¶ˆæ­§ä¹‰çš„é—®é¢˜<ul>
<li>ç•¥ï¼ŒSpringBoot ä¸­å¾ˆå°‘ç¢°åˆ°</li>
</ul>
</li>
<li>ä¾èµ–è§£ææµç¨‹<ul>
<li>å®¹å™¨æ‰§è¡Œ bean ä¾èµ–è§£æå¦‚ä¸‹ï¼š<ul>
<li><code>ApplicationContext</code> æ˜¯ç”¨æè¿°æ‰€æœ‰ bean çš„é…ç½®å…ƒæ•°æ®åˆ›å»ºå’Œåˆå§‹åŒ–çš„ã€‚ é…ç½®å…ƒæ•°æ®å¯ä»¥ç”± XMLã€Java ä»£ç æˆ–æ³¨è§£æŒ‡å®šã€‚</li>
<li>å¯¹äºæ¯ä¸ª beanï¼Œå®ƒçš„ä¾èµ–å…³ç³»ä»¥å±æ€§ã€æ„é€ å‡½æ•°å‚æ•°æˆ–é™æ€å·¥å‚æ–¹æ³•çš„å‚æ•°ï¼ˆå¦‚æœæ‚¨ä½¿ç”¨å®ƒè€Œä¸æ˜¯æ™®é€šæ„é€ å‡½æ•°ï¼‰çš„å½¢å¼è¡¨ç¤ºã€‚ åœ¨å®é™…åˆ›å»º bean æ—¶ï¼Œå°†è¿™äº›ä¾èµ–å…³ç³»æä¾›ç»™ beanã€‚</li>
<li>æ¯ä¸ªå±æ€§æˆ–æ„é€ å‡½æ•°å‚æ•°éƒ½æ˜¯è¦è®¾ç½®çš„å€¼çš„å®é™…å®šä¹‰ï¼Œæˆ–è€…æ˜¯å¯¹å®¹å™¨ä¸­å¦ä¸€ä¸ª bean çš„å¼•ç”¨ã€‚</li>
<li>ä½œä¸ºå€¼çš„æ¯ä¸ªå±æ€§æˆ–æ„é€ å‡½æ•°å‚æ•°éƒ½ä»å…¶æŒ‡å®šæ ¼å¼è½¬æ¢ä¸ºè¯¥å±æ€§æˆ–æ„é€ å‡½æ•°å‚æ•°çš„å®é™…ç±»å‹ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring å¯ä»¥å°†å­—ç¬¦ä¸²æ ¼å¼æä¾›çš„å€¼è½¬æ¢ä¸ºæ‰€æœ‰å†…ç½®ç±»å‹ï¼Œä¾‹å¦‚ <code>int</code>ã€<code>long</code>ã€<code>String</code>ã€<code>boolean</code> ç­‰ç­‰ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="1-5-åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®"><a href="#1-5-åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®" class="headerlink" title="1.5. åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®"></a>1.5. åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®</h2><h3 id="1-5-1-Required"><a href="#1-5-1-Required" class="headerlink" title="1.5.1. @Required"></a>1.5.1. @Required</h3><p><code>@Required</code> æ³¨è§£é€‚ç”¨äº bean å±æ€§ setter æ–¹æ³•ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Required</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ³¨è§£è¡¨æ˜å¿…é¡»åœ¨é…ç½®æ—¶é€šè¿‡ bean å®šä¹‰ä¸­çš„æ˜¾å¼å±æ€§å€¼æˆ–é€šè¿‡è‡ªåŠ¨è£…é…æ¥å¡«å……å—å½±å“çš„ bean å±æ€§ã€‚ å¦‚æœå°šæœªå¡«å……å—å½±å“çš„ bean å±æ€§ï¼Œåˆ™å®¹å™¨å°†å¼•å‘å¼‚å¸¸ã€‚ é¿å…ä»¥åå‡ºç° <code>NullPointerException</code> å®ä¾‹ç­‰ã€‚</p>
<blockquote>
<p><code>@Required</code> æ³¨è§£å’Œ <code>RequiredAnnotationBeanPostProcessor</code> ä» Spring Framework 5.1 å¼€å§‹æ­£å¼å¼ƒç”¨ï¼Œèµæˆä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥è¿›è¡Œæ‰€éœ€è®¾ç½®ï¼ˆæˆ– <code>InitializingBean.afterPropertiesSet çš„è‡ªå®šä¹‰å®ç° ()</code> æˆ–è‡ªå®šä¹‰ <code>@PostConstruct</code> æ–¹æ³•ä»¥åŠ bean å±æ€§ setter æ–¹æ³•ï¼‰</p>
</blockquote>
<h3 id="1-5-2-Autowired"><a href="#1-5-2-Autowired" class="headerlink" title="1.5.2. @Autowired"></a>1.5.2. @Autowired</h3><p>æ‚¨å¯ä»¥å°† <code>@Autowired</code> æ³¨è§£åº”ç”¨äºæ„é€ å‡½æ•°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CustomerPreferenceDao customerPreferenceDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MovieRecommender</span><span class="params">(CustomerPreferenceDao customerPreferenceDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.customerPreferenceDao = customerPreferenceDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä» Spring Framework 4.3 å¼€å§‹ï¼Œå¦‚æœç›®æ ‡ bean åªå®šä¹‰äº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œåˆ™ä¸å†éœ€è¦åœ¨è¿™æ ·çš„æ„é€ å‡½æ•°ä¸Šæ·»åŠ  <code>@Autowired</code> æ³¨è§£ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæœ‰å¤šä¸ªæ„é€ å‡½æ•°å¯ç”¨ä¸”æ²¡æœ‰ä¸»&#x2F;é»˜è®¤æ„é€ å‡½æ•°ï¼Œåˆ™å¿…é¡»è‡³å°‘ç”¨ <code>@Autowired</code> æ³¨è§£å…¶ä¸­ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œä»¥ä¾¿æŒ‡ç¤ºå®¹å™¨ä½¿ç”¨å“ªä¸€ä¸ªã€‚</p>
</blockquote>
<p>æ‚¨è¿˜å¯ä»¥å°† <code>@Autowired</code> æ³¨è§£åº”ç”¨äº <em>ä¼ ç»Ÿ</em> setter æ–¹æ³•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‚¨è¿˜å¯ä»¥å°†æ³¨è§£åº”ç”¨äºå…·æœ‰ä»»æ„åç§°å’Œå¤šä¸ªå‚æ•°çš„æ–¹æ³•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog movieCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CustomerPreferenceDao customerPreferenceDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">prepare</span><span class="params">(MovieCatalog movieCatalog,</span></span><br><span class="line"><span class="params">            CustomerPreferenceDao customerPreferenceDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieCatalog = movieCatalog;</span><br><span class="line">        <span class="built_in">this</span>.customerPreferenceDao = customerPreferenceDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‚¨ä¹Ÿå¯ä»¥å°† <code>@Autowired</code> åº”ç”¨äºå­—æ®µï¼Œç”šè‡³å°†å…¶ä¸æ„é€ å‡½æ•°æ··åˆï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CustomerPreferenceDao customerPreferenceDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog movieCatalog;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MovieRecommender</span><span class="params">(CustomerPreferenceDao customerPreferenceDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.customerPreferenceDao = customerPreferenceDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‚¨è¿˜å¯ä»¥é€šè¿‡å°† <code>@Autowired</code> æ³¨è§£æ·»åŠ åˆ°éœ€è¦è¯¥ç±»å‹æ•°ç»„çš„å­—æ®µæˆ–æ–¹æ³•æ¥æŒ‡ç¤º Spring ä» <code>ApplicationContext</code> æä¾›ç‰¹å®šç±»å‹çš„æ‰€æœ‰ beanï¼Œå¦‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MovieCatalog[] movieCatalogs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç»™å®šæ³¨å…¥ç‚¹æ²¡æœ‰åŒ¹é…çš„å€™é€‰ bean å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨è£…é…å¤±è´¥ã€‚ å¯¹äºå£°æ˜çš„æ•°ç»„ã€é›†åˆæˆ–æ˜ å°„ï¼Œè‡³å°‘éœ€è¦ä¸€ä¸ªåŒ¹é…å…ƒç´ ã€‚</p>
<p>é»˜è®¤è¡Œä¸ºæ˜¯å°†å¸¦æ³¨è§£çš„æ–¹æ³•å’Œå­—æ®µè§†ä¸ºæŒ‡ç¤ºæ‰€éœ€çš„ä¾èµ–é¡¹ã€‚ æ‚¨å¯ä»¥æ›´æ”¹æ­¤è¡Œä¸ºï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼Œé€šè¿‡å°†ä¸å¯æ»¡è¶³çš„æ³¨å…¥ç‚¹æ ‡è®°ä¸ºéå¿…éœ€ï¼ˆå³ï¼Œé€šè¿‡åœ¨ <code>@ è‡ªåŠ¨è¿çº¿</code>åˆ°<code>false</code>ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleMovieLister</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMovieFinder</span><span class="params">(MovieFinder movieFinder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.movieFinder = movieFinder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-5-3-Primary"><a href="#1-5-3-Primary" class="headerlink" title="1.5.3. @Primary"></a>1.5.3. @Primary</h3><ul>
<li><code>@Primary</code> è¡¨ç¤ºå½“å¤šä¸ª bean æ˜¯è‡ªåŠ¨è£…é…åˆ°å•å€¼ä¾èµ–é¡¹çš„å€™é€‰è€…æ—¶ï¼Œåº”ä¼˜å…ˆè€ƒè™‘ç‰¹å®š beanã€‚ å¦‚æœå€™é€‰ä¸­æ°å¥½å­˜åœ¨ä¸€ä¸ªä¸»è¦ beanï¼Œåˆ™å®ƒæˆä¸ºè‡ªåŠ¨è£…é…çš„å€¼ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> MovieCatalog <span class="title function_">firstMovieCatalog</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MovieCatalog <span class="title function_">secondMovieCatalog</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-5-4-ä½¿ç”¨æ³›å‹ä½œä¸ºè‡ªåŠ¨è£…é…é™å®šç¬¦"><a href="#1-5-4-ä½¿ç”¨æ³›å‹ä½œä¸ºè‡ªåŠ¨è£…é…é™å®šç¬¦" class="headerlink" title="1.5.4. ä½¿ç”¨æ³›å‹ä½œä¸ºè‡ªåŠ¨è£…é…é™å®šç¬¦"></a>1.5.4. ä½¿ç”¨æ³›å‹ä½œä¸ºè‡ªåŠ¨è£…é…é™å®šç¬¦</h3><ul>
<li>å¯ä»¥ç”¨æ³›å‹å’Œ<code>@Autowired</code>æ­é…è£…é…</li>
</ul>
<h3 id="1-5-5-Resource"><a href="#1-5-5-Resource" class="headerlink" title="1.5.5. @Resource"></a>1.5.5. @Resource</h3><p>Spring è¿˜é€šè¿‡åœ¨å­—æ®µæˆ– bean å±æ€§ setter æ–¹æ³•ä¸Šä½¿ç”¨ JSR-250 <code>@Resource</code> æ³¨è§£ (<code>javax.annotation.Resource</code>) æ¥æ”¯æŒæ³¨å…¥ã€‚</p>
<p>åœ¨æ²¡æœ‰æŒ‡å®šæ˜¾å¼åç§°çš„ <code>@Resource</code> ç”¨æ³•çš„å”¯ä¸€æƒ…å†µä¸‹ï¼Œä¸ <code>@Autowired</code> ç±»ä¼¼ï¼Œ<code>@Resource</code> æ‰¾åˆ°ä¸»è¦ç±»å‹åŒ¹é…è€Œä¸æ˜¯ ä¸€ä¸ªç‰¹å®šçš„å‘½å bean å¹¶è§£æä¼—æ‰€å‘¨çŸ¥çš„å¯è§£æä¾èµ–é¡¹ï¼š<code>BeanFactory</code>ã€<code>ApplicationContext</code>ã€<code>ResourceLoader</code>ã€<code>ApplicationEventPublisher</code> å’Œ <code>MessageSource</code> æ¥å£ã€‚</p>
<h3 id="1-5-6-Value"><a href="#1-5-6-Value" class="headerlink" title="1.5.6. @Value"></a>1.5.6. @Value</h3><p><code>@Value</code> é€šå¸¸ç”¨äºæ³¨å…¥å¤–åŒ–å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String catalog;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MovieRecommender</span><span class="params">(<span class="meta">@Value(&quot;$&#123;catalog.name&#125;&quot;)</span> String catalog)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.catalog = catalog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:application.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123; &#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥åŠä»¥ä¸‹ <code>application.properties</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">catalog.name=MovieCatalog</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>catalog</code> å‚æ•°å’Œå­—æ®µå°†ç­‰äº <code>MovieCatalog</code> å€¼ã€‚</p>
<p>Spring æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„å®½æ¾åµŒå…¥å€¼è§£æå™¨ã€‚ å®ƒå°†å°è¯•è§£æå±æ€§å€¼ï¼Œå¦‚æœæ— æ³•è§£æï¼Œåˆ™å±æ€§åç§°ï¼ˆä¾‹å¦‚ <code>$&#123;catalog.name&#125;</code>ï¼‰å°†ä½œä¸ºå€¼æ³¨å…¥ã€‚ å¦‚æœä½ æƒ³å¯¹ä¸å­˜åœ¨çš„å€¼ä¿æŒä¸¥æ ¼çš„æ§åˆ¶ï¼Œä½ åº”è¯¥å£°æ˜ä¸€ä¸ª <code>PropertySourcesPlaceholderConfigurer</code> beanï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PropertySourcesPlaceholderConfigurer <span class="title function_">propertyPlaceholderConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PropertySourcesPlaceholderConfigurer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Spring Boot é»˜è®¤é…ç½®ä¸€ä¸ª <code>PropertySourcesPlaceholderConfigurer</code> beanï¼Œå®ƒå°†ä» <code>application.properties</code> å’Œ <code>application.yml</code> æ–‡ä»¶ä¸­è·å–å±æ€§ã€‚</p>
</blockquote>
<p>å½“ <code>@Value</code> åŒ…å« <a target="_blank" rel="noopener" href="https://geekdoc.top/docs/languages/java/spring-framework/5.3.11/reference/html/core.html#expressions"><code>SpEL</code> è¡¨è¾¾å¼</a> æ—¶ï¼Œè¯¥å€¼å°†åœ¨è¿è¡Œæ—¶åŠ¨æ€è®¡ç®—ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<ul>
<li>æ³¨ï¼šSpEL è¡¨è¾¾å¼æ˜¯ Spring è¡¨è¾¾å¼è¯­è¨€</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MovieRecommender</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String catalog;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MovieRecommender</span><span class="params">(<span class="meta">@Value(&quot;#&#123;systemProperties[&#x27;user.catalog&#x27;] + &#x27;Catalog&#x27; &#125;&quot;)</span> String catalog)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.catalog = catalog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-5-7-Component-å’Œè¿›ä¸€æ­¥çš„å®šå‹æ³¨è§£"><a href="#1-5-7-Component-å’Œè¿›ä¸€æ­¥çš„å®šå‹æ³¨è§£" class="headerlink" title="1.5.7. @Component å’Œè¿›ä¸€æ­¥çš„å®šå‹æ³¨è§£"></a>1.5.7. @Component å’Œè¿›ä¸€æ­¥çš„å®šå‹æ³¨è§£</h3><p><code>@Repository</code> æ³¨è§£æ˜¯ä»»ä½•å®ç°å­˜å‚¨åº“è§’è‰²æˆ–æ„é€ å‹ï¼ˆä¹Ÿç§°ä¸ºæ•°æ®è®¿é—®å¯¹è±¡æˆ– DAOï¼‰çš„ç±»çš„æ ‡è®°ã€‚ æ­¤æ ‡è®°çš„ç”¨é€”ä¹‹ä¸€æ˜¯è‡ªåŠ¨è½¬æ¢å¼‚å¸¸ã€‚</p>
<p>Spring æä¾›äº†æ›´å¤šæ„é€ å‹æ³¨è§£ï¼š<code>@Component</code>ã€<code>@Service</code> å’Œ <code>@Controller</code>ã€‚ <code>@Component</code> æ˜¯ä»»ä½• Spring ç®¡ç†çš„ç»„ä»¶çš„é€šç”¨æ„é€ å‹ã€‚</p>
<p><code>@Repository</code>ã€<code>@Service</code> å’Œ <code>@Controller</code> æ˜¯ <code>@Component</code> çš„ç‰¹åŒ–ï¼Œç”¨äºæ›´å…·ä½“çš„ç”¨ä¾‹ï¼ˆåœ¨åˆ†åˆ«ä¸ºæŒä¹…å±‚ã€æœåŠ¡å±‚å’Œè¡¨ç¤ºå±‚ï¼‰ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>@Component</code> æ³¨è§£æ‚¨çš„ç»„ä»¶ç±»ï¼Œä½†æ˜¯ï¼Œé€šè¿‡ä½¿ç”¨ <code>@Repository</code>ã€<code>@Service</code> æˆ– <code>@ æ³¨è§£å®ƒä»¬Controller</code> ç›¸åï¼Œæ‚¨çš„ç±»æ›´é€‚åˆç”±å·¥å…·å¤„ç†æˆ–ä¸åˆ‡é¢ç›¸å…³è”ã€‚ä¾‹å¦‚ï¼Œè¿™äº›æ„é€ å‹æ³¨è§£æ˜¯åˆ‡å…¥ç‚¹çš„ç†æƒ³ç›®æ ‡ã€‚ <code>@Repository</code>ã€<code>@Service</code> å’Œ <code>@Controller</code> è¿˜å¯ä»¥åœ¨ Spring Framework çš„æœªæ¥ç‰ˆæœ¬ä¸­æºå¸¦é¢å¤–çš„è¯­ä¹‰ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨åœ¨æœåŠ¡å±‚ä½¿ç”¨ <code>@Component</code> æˆ– <code>@Service</code> ä¹‹é—´åšå‡ºé€‰æ‹©ï¼Œ<code>@Service</code> æ˜¾ç„¶æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚åŒæ ·ï¼Œå¦‚å‰æ‰€è¿°ï¼Œ<code>@Repository</code> å·²ç»è¢«æ”¯æŒä½œä¸ºæŒä¹…å±‚ä¸­è‡ªåŠ¨å¼‚å¸¸è½¬æ¢çš„æ ‡è®°ã€‚</p>
<h2 id="1-6-åŸºäº-Java-çš„å®¹å™¨é…ç½®"><a href="#1-6-åŸºäº-Java-çš„å®¹å™¨é…ç½®" class="headerlink" title="1.6. åŸºäº Java çš„å®¹å™¨é…ç½®"></a>1.6. åŸºäº Java çš„å®¹å™¨é…ç½®</h2><h3 id="1-6-1-Bean-å’Œ-Component"><a href="#1-6-1-Bean-å’Œ-Component" class="headerlink" title="1.6.1. @Bean å’Œ@Component"></a>1.6.1. @Bean å’Œ@Component</h3><p>Spring çš„æ–° Java é…ç½®æ”¯æŒä¸­çš„æ ¸å¿ƒå·¥ä»¶æ˜¯ <code>@Configuration</code> æ³¨è§£ç±»å’Œ <code>@Bean</code> æ³¨è§£æ–¹æ³•ã€‚</p>
<p><code>@Bean</code> æ³¨è§£ç”¨äºæŒ‡ç¤ºä¸€ä¸ªæ–¹æ³•å®ä¾‹åŒ–ã€é…ç½®å’Œåˆå§‹åŒ–ä¸€ä¸ªç”± Spring IoC å®¹å™¨ç®¡ç†çš„æ–°å¯¹è±¡ã€‚ å¯¹äºç†Ÿæ‚‰ Spring çš„ &#96;&#96;XML é…ç½®çš„äººæ¥è¯´ï¼Œ<code> </code>@Bean<code>æ³¨è§£ä¸å…ƒç´ æ‰®æ¼”ç€ç›¸åŒçš„è§’è‰²ã€‚ æ‚¨å¯ä»¥å°†å¸¦æœ‰</code>@Bean<code>æ³¨è§£çš„æ–¹æ³•ä¸ä»»ä½• Spring</code>@Component<code>ä¸€èµ·ä½¿ç”¨ã€‚ ç„¶è€Œï¼Œå®ƒä»¬æœ€å¸¸ä¸</code>@Configuration&#96; bean ä¸€èµ·ä½¿ç”¨ã€‚</p>
<p>ç”¨ <code>@Configuration</code> æ³¨è§£ä¸€ä¸ªç±»è¡¨æ˜å®ƒçš„ä¸»è¦ç›®çš„æ˜¯ä½œä¸º bean å®šä¹‰çš„æ¥æºã€‚ æ­¤å¤–ï¼Œ<code>@Configuration</code> ç±»å…è®¸é€šè¿‡è°ƒç”¨åŒä¸€ç±»ä¸­çš„å…¶ä»– <code>@Bean</code> æ–¹æ³•æ¥å®šä¹‰ bean é—´çš„ä¾èµ–å…³ç³»ã€‚ æœ€ç®€å•çš„ <code>@Configuration</code> ç±»å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MyService <span class="title function_">myService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ä½¿ç”¨-Component-æ³¨è§£"><a href="#ä½¿ç”¨-Component-æ³¨è§£" class="headerlink" title="ä½¿ç”¨ Component æ³¨è§£"></a>ä½¿ç”¨ Component æ³¨è§£</h5><p><code>@Configuration</code> æ˜¯ä¸€ä¸ªç±»çº§åˆ«çš„æ³¨è§£ï¼Œè¡¨æ˜ä¸€ä¸ªå¯¹è±¡æ˜¯ bean å®šä¹‰çš„æ¥æºã€‚ <code>@Configuration</code> ç±»é€šè¿‡å¸¦æœ‰ <code>@Bean</code> æ³¨è§£çš„æ–¹æ³•æ¥å£°æ˜ beanã€‚ å¯¹ <code>@Configuration</code> ç±»ä¸Šçš„ <code>@Bean</code> æ–¹æ³•çš„è°ƒç”¨ä¹Ÿå¯ç”¨äºå®šä¹‰ bean é—´çš„ä¾èµ–å…³ç³»ã€‚</p>
  </div>
  
    
      <a id="older" class="blog-nav" href="/article/a-MVVM-toy-with-TypeScript/">OLDER&nbsp;&gt;</a>
      
        
          <a id="newer" class="blog-nav" href="/article/Spring%E5%AD%A6%E4%B9%A02/">&lt;&nbsp;NEWER</a>
          
            
</div>
        <div class="footer">
  
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/Pengzna">Copyright Â© Pengzna 2021-present</a>
        
    </div>
  
</div>

      </div>

      <div class="back-to-top hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



      
  <div class="search-icon" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-box">
        <div class="search-title">
          <!-- <span class="search-icon-input">
            <a href="javascript: void(0)">
              <i class="iconfont icon-search"></i>
            </a>
          </span> -->
          
            <input type="text" class="search-input" id="search-input" placeholder="æœç´¢">
          
          <span class="search-close-icon" id="search-close-icon">
            <a href="javascript: void(0)">
              <i class="iconfont icon-close"></i>
            </a>
          </span>
        </div>
        <div class="search-result" id="search-result"></div>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    // inputArea.onclick = function() {
    //   getSearchFile()
    //   this.onclick = null
    // }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        inputArea.focus()
        getSearchFile()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'><span></ul>";
      // $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'><h2>" + orig_data_title + "</h2></a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<h3 class=\"search-result-abstract\">" + match_content + "...</h3>"
                }
                str += "<hr></li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer toï¼š<a href='https://github.com/leedom92/hexo-theme-leedom#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




    </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </body>
</html>

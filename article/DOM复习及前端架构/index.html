<!DOCTYPE html>
<html lang="en">

  <head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="Pengzna,blog" />
  <meta name="author" content="Pengzna" />
  <meta name="description" content="Pengzna çš„åšå®¢" />
  
  
  <title>
    
      DOM å¤ä¹ åŠå‰ç«¯æ¶æ„ 
      
      
    
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto:400,400italic,600|Roboto+Mono" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/css/common.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">


  

  
    
<link rel="stylesheet" href="/css/post.css">

  

  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


<meta name="generator" content="Hexo 7.0.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>


  <body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="app">
      <div class="header">
  <a href="/">Pengzna's blog ğŸ‘‹</a>
</div>


      <p class="links">
  
    <a title="archives" target="" href="/archives/">
      <i class="iconfont icon-bookmark"></i>
    </a>
  
    <a title="github" target="_blank" href="https://github.com/Pengzna">
      <i class="iconfont icon-github"></i>
    </a>
  
    <a title="email" target="_blank" href="mailto:junzhi.pengzna@gmail.com">
      <i class="iconfont icon-envelope"></i>
    </a>
  
    <a title="linkedin" target="_blank" href="https://www.linkedin.com/in/pengzna/">
      <i class="iconfont icon-linkedin"></i>
    </a>
  
    <a title="wechat" target="_blank" href="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20231115013033249.png">
      <i class="iconfont icon-wechat"></i>
    </a>
  
</p>


      <div class="main">
        <!-- æ–‡ç« è¯¦æƒ…é¡µï¼Œå±•ç¤ºæ–‡ç« å…·ä½“å†…å®¹ï¼Œurlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
<!-- åŒæ—¶ä¸ºã€Œæ ‡ç­¾tagã€ï¼Œã€Œæœ‹å‹friendã€ï¼Œã€Œåˆ†ç±»categoriesã€ï¼Œã€Œå…³äºaboutã€é¡µé¢çš„æ‰¿è½½é¡µé¢ï¼Œå…·ä½“å±•ç¤ºå–å†³äºpage.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
</script>

<div class="post">
  <h3 class="date">
    Jul 25, 2022
  </h3>
  <h1>
    DOM å¤ä¹ åŠå‰ç«¯æ¶æ„
  </h1>
  <div class="content markdown-body">
    <h2 id="1-DOMåŸºç¡€"><a href="#1-DOMåŸºç¡€" class="headerlink" title="1. DOMåŸºç¡€"></a>1. DOMåŸºç¡€</h2><ul>
<li>DOMæ˜¯Document Object Modelçš„ç®€å†™ï¼Œæ–‡æ¡£å¯¹è±¡æ¨¡å‹</li>
<li>DOMæ˜¯HTMLçš„ç¼–ç¨‹æ¥å£</li>
</ul>
<p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20220714162844731.png" alt="image-20220714162844731"></p>
<p>HTMLæ–‡ä»¶å’ŒDOMæ ‘æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»</p>
<h3 id="1-1-DOMåŸºæœ¬æ“ä½œ"><a href="#1-1-DOMåŸºæœ¬æ“ä½œ" class="headerlink" title="1.1. DOMåŸºæœ¬æ“ä½œ"></a>1.1. DOMåŸºæœ¬æ“ä½œ</h3><h4 id="1-1-1-æŸ¥"><a href="#1-1-1-æŸ¥" class="headerlink" title="1.1.1. æŸ¥"></a>1.1.1. æŸ¥</h4><ol>
<li><p>é€šè¿‡idæŸ¥æ‰¾</p>
<p><code>document.getElementById(&#39;&#39;)</code></p>
</li>
<li><p>é€šè¿‡æ ‡ç­¾åæŸ¥æ‰¾</p>
<p><code>document.getElementsByTagName(&#39;&#39;)</code></p>
<p>è¿”å›çš„æ˜¯NodeListï¼ˆç±»æ•°ç»„çš„å¯¹è±¡ï¼‰</p>
</li>
<li><p>é€šè¿‡classæŸ¥æ‰¾</p>
<p><code>document.getElementsByClass(&#39;&#39;)</code></p>
</li>
<li><p>æ ¹æ®ä¼ å…¥çš„cssé€‰æ‹©å™¨ï¼ŒæŸ¥æ‰¾åŒ¹é…çš„DOMç»“ç‚¹</p>
<ol>
<li><code>document.querySelector(&quot;p&quot;)</code> åªè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„DOMç»“ç‚¹</li>
<li><code>document.querySelectorAll(&quot;.detail&quot;)</code> è¿”å›ç±»ä¸ºdetailçš„æ‰€æœ‰DOMç»“ç‚¹çš„é›†åˆ<ol>
<li>eg: <code>document.querySelectorAll(&quot;ul &gt; li&quot;)</code>; åŒ¹é…åµŒå¥—åœ¨ulä¸­çš„æ‰€æœ‰liå…ƒç´ </li>
<li><code>document.querySelectorAll(&quot;img+h3&quot;)</code>ï¼›åŒ¹é…æ‰€æœ‰ç´§é‚»åœ¨imgåçš„h3å…ƒç´ </li>
<li><code>document.querySelectorAll(&#39;[data-index]&#39;)</code>; åŒ¹é…æ‰€æœ‰æœ‰data-indexå±æ€§çš„å…ƒç´ </li>
</ol>
</li>
</ol>
</li>
<li><p>æ ¹æ®å·²è·å–çš„ç»“ç‚¹ï¼Œæ‹¿åˆ°è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æˆ–çˆ¶èŠ‚ç‚¹</p>
<ol>
<li><code>document.getElementById(&#39;&#39;).parentNode / nextElementSibling / [0]</code></li>
</ol>
</li>
</ol>
<h4 id="1-1-2-æ”¹"><a href="#1-1-2-æ”¹" class="headerlink" title="1.1.2. æ”¹"></a>1.1.2. æ”¹</h4><ol>
<li><p>æ”¹innerHTML</p>
<p><code>dom.innerHTML = &quot;&lt;strong&gt;ä¿®æ”¹å†…å®¹&lt;strong&gt;&quot;</code></p>
</li>
<li><p>æ”¹textContent</p>
<p><code>dom.textContent = &quot;ä¿®æ”¹textå†…å®¹&quot;</code></p>
</li>
<li><p>ä¿®æ”¹styleå€¼</p>
<p><code>dom.style = &quot;color: blue&quot;</code></p>
</li>
<li><p>ä¿®æ”¹æŒ‡å®šå±æ€§å€¼</p>
<p><code>dom.setAttribute(&quot;some-attribute&quot;, &quot;666&quot;)</code></p>
</li>
</ol>
<h4 id="1-1-3-å¢"><a href="#1-1-3-å¢" class="headerlink" title="1.1.3. å¢"></a>1.1.3. å¢</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getCurrentTimeStr</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="keyword">const</span> hour = date.<span class="title function_">getHours</span>();</span><br><span class="line">    <span class="keyword">const</span> minutes = date.<span class="title function_">getMinutes</span>();</span><br><span class="line">    <span class="keyword">const</span> second = date.<span class="title function_">getSeconds</span>();</span><br><span class="line">    <span class="keyword">return</span> [hour, minutes, second].<span class="title function_">join</span>(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ›å»ºå…ƒç´ </span></span><br><span class="line"><span class="keyword">let</span> newDom = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;p&quot;</span>)</span><br><span class="line">newDom.<span class="property">textContent</span> = <span class="string">&quot;é¡µé¢åŠ è½½æ—¶é—´ä¸º&quot;</span> + <span class="title function_">getCurrentTimeStr</span>();</span><br><span class="line"><span class="comment">// å°†æ–°åˆ›å»ºçš„ç»“ç‚¹æ·»åŠ åˆ°bodyçš„å­èŠ‚ç‚¹åˆ—è¡¨çš„æœ«å°¾å¤„</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(newDom) <span class="comment">// or ParentNode.appendChild(newDom)</span></span><br></pre></td></tr></table></figure>

<h4 id="1-1-4-åˆ "><a href="#1-1-4-åˆ " class="headerlink" title="1.1.4. åˆ "></a>1.1.4. åˆ </h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> liToRemove = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;li&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">liToRemove.<span class="title function_">remove</span>();</span><br></pre></td></tr></table></figure>

<h2 id="2-DOMäº‹ä»¶"><a href="#2-DOMäº‹ä»¶" class="headerlink" title="2. DOMäº‹ä»¶"></a>2. DOMäº‹ä»¶</h2><h3 id="2-1-ä»€ä¹ˆæ˜¯DOMäº‹ä»¶"><a href="#2-1-ä»€ä¹ˆæ˜¯DOMäº‹ä»¶" class="headerlink" title="2.1. ä»€ä¹ˆæ˜¯DOMäº‹ä»¶"></a>2.1. ä»€ä¹ˆæ˜¯DOMäº‹ä»¶</h3><ul>
<li>Demo</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> liDom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;something&quot;</span>)</span><br><span class="line"><span class="comment">// DOM 0çº§</span></span><br><span class="line">liDom.<span class="property">onclick</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;exe!&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>é¡µé¢ä¸Šçš„DOMä¹‹é—´æ˜¯åµŒå¥—çš„ç»“æ„ï¼Œå¦‚æœç»™å†…å±‚DOMç»‘å®šäº†äº‹ä»¶ç›‘å¬å‡½æ•°ï¼Œåˆ™å¤–å±‚çš„DOMä¹Ÿä¼šç›¸åº”è§¦å‘ç‚¹å‡»äº‹ä»¶</li>
</ul>
<h3 id="2-2-DOMäº‹ä»¶ä¼ æ’­"><a href="#2-2-DOMäº‹ä»¶ä¼ æ’­" class="headerlink" title="2.2. DOMäº‹ä»¶ä¼ æ’­"></a>2.2. DOMäº‹ä»¶ä¼ æ’­</h3><ul>
<li>äº‹ä»¶æ•è·é˜¶æ®µ â€“&gt; ç›®æ ‡äº‹ä»¶é˜¶æ®µ â€“&gt; äº‹ä»¶å†’æ³¡é˜¶æ®µ</li>
</ul>
<p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20220714170409071.png" alt="image-20220714170409071"></p>
<h3 id="2-2-addEventListener"><a href="#2-2-addEventListener" class="headerlink" title="2.2. addEventListener"></a>2.2. addEventListener</h3><p>DOM 2çº§</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> liDom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;something&quot;</span>)</span><br><span class="line">liDom.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span>(<span class="params">event</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;exe!(å›è°ƒ1)&#x27;</span>)</span><br><span class="line">&#125;); <span class="comment">// å…¶å®è¿˜æœ‰ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œonceï¼šæ˜¯å¦åªå“åº”ä¸€æ¬¡ï¼›captureï¼šæ˜¯å¦åœ¨æ•è·é˜¶æ®µè§¦å‘ï¼ˆé»˜è®¤æ˜¯falseï¼šå³åœ¨å†’æ³¡é˜¶æ®µè§¦å‘ï¼‰</span></span><br><span class="line">liDom.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span>(<span class="params">event</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;exe!(å›è°ƒ2)&#x27;</span>)</span><br><span class="line">&#125;, &#123; <span class="attr">once</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">liDom.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span>(<span class="params">event</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;exe!(å›è°ƒ3)&#x27;</span>)</span><br><span class="line">&#125;, &#123; <span class="attr">once</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>å’Œç›´æ¥onClickç›¸æ¯”ï¼Œå¯ä»¥ç»™ä¸€ä¸ªDOMç»‘å®šå¤šä¸ªäº‹ä»¶</li>
</ul>
<h2 id="3-BOM"><a href="#3-BOM" class="headerlink" title="3. BOM"></a>3. BOM</h2><p>Browser Object Modelï¼Œæ§åˆ¶æµè§ˆå™¨çš„è¡Œä¸ºçš„æ¥å£</p>
<h3 id="3-1-é€šè¿‡windowè®¿é—®"><a href="#3-1-é€šè¿‡windowè®¿é—®" class="headerlink" title="3.1. é€šè¿‡windowè®¿é—®"></a>3.1. é€šè¿‡windowè®¿é—®</h3><ul>
<li>é€šè¿‡windowå¯ä»¥è®¿é—®æµè§ˆå™¨æä¾›çš„BOMå¯¹è±¡<ul>
<li>location</li>
<li>navigator</li>
<li>screen</li>
<li>alertã€promptã€confirm</li>
<li>localStorage</li>
<li>â€¦</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">alert</span>(<span class="string">&quot;welcome!&quot;</span>) <span class="comment">// æç¤ºæ¡†</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> res = <span class="variable language_">window</span>,<span class="title function_">prompt</span>(<span class="string">&quot;è¯·è¾“å…¥...&quot;</span>, <span class="string">&quot;å¼ ä¸‰&quot;</span>) <span class="comment">// è¾“å…¥æç¤ºæ¡†ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥å†…å®¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> iinfo = <span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="property">userAgent</span> <span class="comment">// è·å–æµè§ˆå™¨å’Œç³»ç»Ÿä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> res = <span class="variable language_">window</span>.<span class="title function_">confirm</span>(<span class="string">&quot;æ˜¯å¦è·³è½¬ï¼Ÿ&quot;</span>) <span class="comment">// å¼¹å‡ºç¡®è®¤æ¡† </span></span><br><span class="line"><span class="keyword">if</span>(res) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;http://www.baidu.com&quot;</span> <span class="comment">// è·³è½¬åˆ°ç™¾åº¦é¦–é¡µ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥çœwindow</span></span><br><span class="line">location.<span class="property">href</span> <span class="comment">// å®Œæ•´url</span></span><br><span class="line">location.<span class="property">protocol</span> <span class="comment">// åè®®å¤´</span></span><br><span class="line">location.<span class="property">host</span> <span class="comment">// åŸŸå</span></span><br><span class="line">location.<span class="property">pathname</span> <span class="comment">// è·¯å¾„</span></span><br><span class="line">location.<span class="property">search</span> <span class="comment">// å‚æ•°</span></span><br><span class="line">location.<span class="property">hash</span> <span class="comment">// å“ˆå¸Œå€¼</span></span><br></pre></td></tr></table></figure>

<h2 id="4-AJAX"><a href="#4-AJAX" class="headerlink" title="4. AJAX"></a>4. AJAX</h2><p>AJAXæ˜¯å¼‚æ­¥çš„Javascriptå’ŒXMLï¼Œå¯ä»¥è¯·æ±‚æœåŠ¡ç«¯æ•°æ®ï¼Œå¹¶å°†æ•°æ®æ›´æ–°åˆ°é¡µé¢ä¸Šï¼Œä¸”æ˜¯å¼‚æ­¥çš„</p>
<h3 id="4-1-XMLHttpRequest"><a href="#4-1-XMLHttpRequest" class="headerlink" title="4.1. XMLHttpRequest"></a>4.1. XMLHttpRequest</h3><p>ä½¿ç”¨XMLHttpRequestå¯¹è±¡ä¸æœåŠ¡å™¨é€šä¿¡</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> httpRequest = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line"><span class="keyword">if</span>(!httpRequest) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;æµè§ˆå™¨ä¸æ”¯æŒXMLHttpRequestï¼Œå¦‚IEï¼&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    httpRequest.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// æœåŠ¡å™¨å“åº”æ—¶è§¦å‘æ­¤å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (httpRequest.<span class="property">readyState</span> === httpRequest.<span class="property">DONE</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (httpRequest.<span class="property">status</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(httpRequest.<span class="property">responseText</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;error!&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;readyState change: &quot;</span> + httpRequest.<span class="property">readyState</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    httpRequest.<span class="title function_">open</span>(</span><br><span class="line">        <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;url&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    httpRequest.<span class="title function_">send</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-2-Fetch"><a href="#4-2-Fetch" class="headerlink" title="4.2. Fetch"></a>4.2. Fetch</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;url&#x27;</span>).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> response.<span class="title function_">json</span>();</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">myJson</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(myJson)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-æ¶æ„æ¨¡å¼"><a href="#5-æ¶æ„æ¨¡å¼" class="headerlink" title="5. æ¶æ„æ¨¡å¼"></a>5. æ¶æ„æ¨¡å¼</h2><p>ä»ä¸€ä¸ªä¾‹å­å¼€å§‹â€¦</p>
<p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20220714173054756.png" alt="image-20220714173054756"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;save&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;name&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">let</span> age = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;age&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> listHtml = <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;tr&gt;</span></span><br><span class="line"><span class="string">    	&lt;td&gt;<span class="subst">$&#123;name&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">    	&lt;td&gt;<span class="subst">$&#123;name&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">    &lt;/tr&gt;`</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> tableElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;list&#x27;</span>).<span class="property">innerHTML</span> += listHtml</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;upload&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> listElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;list&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> lineElement = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;tr&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> result = [];</span><br><span class="line">    lineElement.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> tds = item.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">        <span class="keyword">let</span> name = tds[<span class="number">0</span>].<span class="property">innerText</span>;</span><br><span class="line">        <span class="keyword">let</span> age = tds[<span class="number">1</span>].<span class="property">innerText</span>;</span><br><span class="line">        result.<span class="title function_">push</span>(&#123;name, age&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20220714173909347.png" alt="image-20220714173909347"></p>
<p>ä¿®æ”¹ï¼šç»´æŠ¤ä¸€ä¸ªå…¨å±€resultï¼Œç„¶åæ¯æ¬¡å¢åŠ æ—¶æ·»åŠ æ•°æ®åˆ°resultï¼Œæœ€åå¯¼å‡ºçš„æ—¶å€™å°±ä¸éœ€è¦ä»domä¸­å–ï¼Œç›´æ¥å–resultå³å¯</p>
<h2 id="6-MVC"><a href="#6-MVC" class="headerlink" title="6. MVC"></a>6. MVC</h2><h3 id="6-1-æ¶æ„"><a href="#6-1-æ¶æ„" class="headerlink" title="6.1. æ¶æ„"></a>6.1. æ¶æ„</h3><ul>
<li>Model ï¼šæ¯”å¦‚å‰æ–‡ä¸­æåˆ°çš„resultå…¨å±€æ•°ç»„</li>
<li>View</li>
<li>Controller</li>
</ul>
<h3 id="6-2-åŸºäºMVCçš„ä»£ç é‡æ„"><a href="#6-2-åŸºäºMVCçš„ä»£ç é‡æ„" class="headerlink" title="6.2. åŸºäºMVCçš„ä»£ç é‡æ„"></a>6.2. åŸºäºMVCçš„ä»£ç é‡æ„</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> model = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> controller = &#123;</span><br><span class="line">    <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> name = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;name&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">    	<span class="keyword">let</span> age = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;age&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">        model.<span class="title function_">push</span>(&#123; name, age &#125;);</span><br><span class="line">        view.<span class="title function_">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">upload</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(model)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> view = &#123;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> data = model;</span><br><span class="line">        <span class="keyword">let</span> listHtml = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        data.<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123;name, age&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            listHtml += <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;tr&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;<span class="subst">$&#123;name&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;<span class="subst">$&#123;name&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">            &lt;/tr&gt;</span></span><br><span class="line"><span class="string">            `</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">let</span> tableElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;list&#x27;</span>).<span class="property">innerHTML</span> = listHtml</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;save&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    controller.<span class="title function_">add</span>();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;upload&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    controller.<span class="title function_">upload</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20220714174712763.png" alt="image-20220714174712763"></p>
<ul>
<li><p>å†ä¼˜åŒ–ï¼šå•ä¸€èŒè´£</p>
</li>
<li><p>å¦‚ä½•ç›‘å¬modelå˜åŒ–ï¼Ÿ</p>
<ul>
<li><p>è§‚å¯Ÿè€…æ¨¡å¼</p>
<ul>
<li><code>addEventListener</code>å°±æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…æ¨¡å¼</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">target.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, listener);</span><br><span class="line">target.<span class="title function_">dispatchEvent</span>(<span class="string">&#x27;click&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>ç°åœ¨æˆ‘ä»¬è‡ªå·±å¼•å…¥ä¸€ä¸ªç±»ä¼¼çš„äº‹ä»¶ç›‘å¬å™¨</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> event = <span class="keyword">new</span> <span class="title class_">EventEmitter</span>();</span><br><span class="line">event.<span class="title function_">on</span>(<span class="string">&#x27;addItem&#x27;</span>, showList); <span class="comment">// æ³¨å†Œä¸€ä¸ªaddItemæ–¹æ³•ï¼Œå¹¶ä¼ showListæ–¹æ³•</span></span><br><span class="line">event.<span class="title function_">emit</span>(<span class="string">&#x27;addItem&#x27;</span>)ï¼›</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ”¹å†™modelå±‚</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EventEmitter</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_events</span> = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">on</span>(<span class="params">evt, listener</span>) &#123;</span><br><span class="line">        (<span class="variable language_">this</span>.<span class="property">_event</span>[evt] || (<span class="variable language_">this</span>.<span class="property">_events</span>[evt] = [])).<span class="title function_">push</span>(listen)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> event = <span class="title class_">EventEmmitter</span>();</span><br><span class="line">event.<span class="title function_">on</span>(<span class="string">&#x27;add&#x27;</span>, view.<span class="property">update</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> model = &#123;</span><br><span class="line">    _value = [],</span><br><span class="line">	<span class="title function_">push</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_value</span>.<span class="title function_">push</span>(value);</span><br><span class="line">        event.<span class="title function_">emit</span>(<span class="string">&#x27;add&#x27;</span>); <span class="comment">// æ¯æ¬¡pushä¹‹åè§¦å‘addæ–¹æ³•ï¼ˆå³view.updateæ–¹æ³•ï¼‰</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> controller = &#123;</span><br><span class="line">    <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> name = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;name&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">    	<span class="keyword">let</span> age = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;age&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">        model.<span class="title function_">push</span>(&#123; name, age &#125;);</span><br><span class="line">        <span class="comment">// view.update();</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">upload</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(model.<span class="title function_">get</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> view = &#123;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> data = model.<span class="title function_">get</span>();</span><br><span class="line">        <span class="keyword">let</span> listHtml = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        data.<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123;name, age&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            listHtml += <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;tr&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;<span class="subst">$&#123;name&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td&gt;<span class="subst">$&#123;name&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">            &lt;/tr&gt;</span></span><br><span class="line"><span class="string">            `</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">let</span> tableElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;list&#x27;</span>).<span class="property">innerHTML</span> = listHtml</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20220714175834918.png" alt="image-20220714175834918"></p>
<h2 id="7-MVVM"><a href="#7-MVVM" class="headerlink" title="7. MVVM"></a>7. MVVM</h2><p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20220714175940359.png" alt="image-20220714175940359"></p>
<p>ä¿®æ”¹ViewModelå¯ä»¥åŒæ­¥æ›´æ–°åˆ°Viewä¸Š</p>
<p>MVCï¼šå¦‚ä½•æ›´æ–°Model â€¦&amp; èƒ½å¤Ÿè§‚å¯Ÿåˆ°Modelæ›´æ–°çš„æ–¹æ³•</p>
<p>MVVMï¼šåŒ…å«æ•°æ®é©±åŠ¨è§†å›¾æ›´æ–°çš„æœºåˆ¶ &amp; æ¸²æŸ“è§†å›¾çš„æ¨¡æ¿å¼•æ“</p>
<h3 id="7-1-å¦‚ä½•ç»‘å®šè§†å›¾å’Œæ•°æ®çš„å…³ç³»"><a href="#7-1-å¦‚ä½•ç»‘å®šè§†å›¾å’Œæ•°æ®çš„å…³ç³»" class="headerlink" title="7.1. å¦‚ä½•ç»‘å®šè§†å›¾å’Œæ•°æ®çš„å…³ç³»"></a>7.1. å¦‚ä½•ç»‘å®šè§†å›¾å’Œæ•°æ®çš„å…³ç³»</h3><p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20220714182522507.png" alt="image-20220714182522507"></p>
<h3 id="7-2-Vueå®ç°MVVMçš„æ€è·¯"><a href="#7-2-Vueå®ç°MVVMçš„æ€è·¯" class="headerlink" title="7.2. Vueå®ç°MVVMçš„æ€è·¯"></a>7.2. Vueå®ç°MVVMçš„æ€è·¯</h3><h4 id="7-2-1-æ•°æ®åŠ«æŒ"><a href="#7-2-1-æ•°æ®åŠ«æŒ" class="headerlink" title="7.2.1. æ•°æ®åŠ«æŒ"></a>7.2.1. æ•°æ®åŠ«æŒ</h4><blockquote>
<p>æ•°æ®åŠ«æŒ ä¸ºä»€ä¹ˆè¦æ•°æ®åŠ«æŒï¼Ÿå¸¦ç€è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å¦‚ä½•å®ç°æ•°æ®åŠ«æŒï¼Œåœ¨vue2çš„æºç ä¸­æœ‰ä¸ªåä¸ºdefineReactive$$1çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°±æ˜¯ç”¨æ¥å®ç°æ•°æ®åŠ«æŒçš„ï¼Œä½†è¯¥æ–¹æ³•ä¹Ÿåªæ˜¯ä¸ªå£³å­ï¼Œæœ€ç»ˆå®ç°æ•°æ®åŠ«æŒçš„è¿˜æ˜¯é çš„<strong>jsåŸç”Ÿçš„Object.definePropertyæ–¹æ³•</strong>ï¼Œè¿™ä¹Ÿæ˜¯vue2æ­»æ´»ä¸æ”¯æŒie8çš„åŸå› ä¹‹ä¸€ã€‚</p>
</blockquote>
<p>Object.definePropertyæ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«åŠ«æŒçš„å¯¹è±¡</li>
<li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¢«åŠ«æŒçš„å¯¹è±¡ä¸­çš„å±æ€§ï¼ˆkeyï¼‰</li>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªé…ç½®é¡¹å¯¹è±¡ï¼ˆåŒ…æ‹¬ï¼švalueã€enumerableã€configurableã€getå’Œsetç­‰å‡ ä¸ªå±æ€§ï¼‰ï¼Œå¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj,key,&#123;</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>)&#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params"></span>)&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åœ¨åšæ•°æ®åŠ«æŒæ—¶ä¸»è¦ç”¨åˆ°çš„å°±æ˜¯getå’Œsetä¸¤ä¸ªå±æ€§ã€‚</p>
<p>é€šè¿‡è¯¥æ–¹æ³•ï¼Œè¢«åŠ«æŒçš„å¯¹è±¡å±æ€§ï¼Œåªè¦åœ¨å¤–ç•Œè·å–æˆ–è€…ä¿®æ”¹å±æ€§å€¼éƒ½ä¼šè§¦å‘getæˆ–setæ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨getæˆ–setä¸­å¯¹å±æ€§åšä¸€äº›é¢å¤–å¯¹æ“ä½œã€‚</p>
<p>äº†è§£äº†æ•°æ®åŠ«æŒçš„å®ç°ï¼Œä¹Ÿå°±çŸ¥é“äº†æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦åšæ•°æ®åŠ«æŒã€‚æ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°æ®åŠ«æŒå¯¹æ•°æ®åšä¸€äº›é¢å¤–å¯¹æ“ä½œä»è€Œå®ç°å“åº”å¼æ•°æ®ã€‚ä¸‹é¢æˆ‘ä»¬ä»¥vueçš„dataä¸ºä¾‹å®ç°ä¸€ä¸ªç®€å•çš„æ•°æ®åŠ«æŒã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">observe</span>(<span class="params">data</span>)&#123;</span><br><span class="line">    <span class="comment">// dataå¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">    <span class="comment">// &#123;&#125;.toString.call(): åˆ¤æ–­ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span>( (&#123;&#125;).<span class="property">toString</span>.<span class="title function_">call</span>(data) !== <span class="string">&#x27;[object Object]&#x27;</span> ) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//è·å–dataä¸­æ‰€æœ‰çš„å±æ€§</span></span><br><span class="line">    <span class="comment">// ES5 å¼•å…¥äº†Object.keysæ–¹æ³•ï¼Œæˆå‘˜æ˜¯å‚æ•°å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†ï¼ˆ enumerable ï¼‰å±æ€§çš„é”®åã€‚</span></span><br><span class="line">    <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(data); </span><br><span class="line">    <span class="comment">//å¾ªç¯éå†keysä¸ºdataä¸­çš„æ¯ä¸ªå±æ€§åšæ•°æ®åŠ«æŒ</span></span><br><span class="line">    keys.<span class="title function_">foreach</span>(<span class="function"><span class="params">key</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="title function_">defineReactive$$1</span>(data, key, data[key]);</span><br><span class="line">    &#125;)    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defineReactive$$1</span>(<span class="params">obj, key, val</span>)&#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">        <span class="title function_">get</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> val;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">set</span>(<span class="params">newV</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(newV !== val)&#123;</span><br><span class="line">                val = newV;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-2-2-æ¨¡æ¿ç¼–è¯‘"><a href="#7-2-2-æ¨¡æ¿ç¼–è¯‘" class="headerlink" title="7.2.2. æ¨¡æ¿ç¼–è¯‘"></a>7.2.2. æ¨¡æ¿ç¼–è¯‘</h4><blockquote>
<p>ä¸ºä»€ä¹ˆè¦æ¨¡æ¿ç¼–è¯‘ï¼Ÿ æˆ‘ä»¬çŸ¥é“åœ¨vueä¸­æ˜¯é€šè¿‡ä¸€äº›æŒ‡ä»¤æˆ–è€…å°èƒ¡å­è¯­æ³•æ¥å®ç°æ•°æ®ç»‘å®šçš„ï¼Œè€Œæµè§ˆå™¨å¹¶ä¸è®¤è¯†è¿™äº›æŒ‡ä»¤æˆ–è€…å°èƒ¡å­è¯­æ³•ï¼Œå› æ­¤åœ¨é¡µé¢åŠ è½½åéœ€è¦å°†è¿™äº›è¯­æ³•è½¬æ¢æˆçœŸæ­£çš„æ•°æ®å‘ˆç°ç»™ç”¨æˆ·ã€‚</p>
</blockquote>
<p>ä¸‹é¢æˆ‘ä»¬ä»¥inputå…ƒç´ å’Œv-modelæŒ‡ä»¤ä¸ºä¾‹æ¥å®ç°ä¸€ä¸ªç®€å•çš„æ¨¡æ¿ç¼–è¯‘ã€‚ æœ¬æ¡ˆä¾‹ä¸­å®ç°æ¨¡æ¿ç¼–è¯‘çš„æµç¨‹ï¼š</p>
<blockquote>
<ul>
<li>éå†#appä¸‹æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œç„¶åæ ¹æ®èŠ‚ç‚¹çš„ç±»å‹åšç›¸åº”çš„æ“ä½œ<ul>
<li>å¦‚æœæ˜¯å…ƒç´ èŠ‚ç‚¹ï¼Œè·å–è¯¥èŠ‚ç‚¹ä¸­æ‰€æœ‰çš„å±æ€§ï¼ˆattributesï¼‰å¹¶éå†çœ‹æ˜¯å¦æœ‰v-modelæŒ‡ä»¤<ul>
<li>å¦‚æœæœ‰v-modelæŒ‡ä»¤ï¼Œåˆ™æ ¹æ®è¯¥æŒ‡ä»¤ç»‘å®šçš„å±æ€§åï¼ˆdataä¸­çš„å±æ€§åï¼‰è·å–åˆ°å¯¹åº”åˆ°å€¼ï¼Œå¹¶èµ‹å€¼ç»™èŠ‚ç‚¹çš„valueå±æ€§</li>
</ul>
</li>
<li>å¦‚æœæ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œåˆ™çœ‹è¯¥æ–‡æœ¬å†…å®¹ä¸­æ˜¯å¦åŒ…å«å°èƒ¡å­è¯­æ³•<ul>
<li>å¦‚æœæœ‰å°èƒ¡å­è¯­æ³•ï¼ŒåŒæ ·éœ€è¦è§£æå‡ºå°èƒ¡å­ä¸­ç»‘å®šçš„å±æ€§åï¼ˆdataä¸­çš„å±æ€§åï¼‰å¹¶è·å–åˆ°å¯¹åº”åˆ°å€¼æ›¿æ¢è¯¥æ–‡æœ¬å†…å®¹</li>
</ul>
</li>
</ul>
</li>
<li>éå†å®Œæ¯ä¸ªèŠ‚ç‚¹åå†å°†è¯¥èŠ‚ç‚¹ä½œä¸ºå­èŠ‚ç‚¹æ·»åŠ åˆ°htmlåˆ°æ–‡æ¡£ç¢ç‰‡ä¸­</li>
<li>æœ€åå†å°†æ•´ä¸ªæ–‡æ¡£ç¢ç‰‡æ·»åŠ åˆ°domä¸­ éœ€è¦è¯´æ˜åˆ°æ˜¯ï¼šåœ¨vueä¸­å®ç°æ˜¯å€ŸåŠ©è™šæ‹Ÿdomå®ç°çš„ï¼Œè€Œè¿™é‡Œä¸ºäº†ç®€å•å°±å€ŸåŠ©æ–‡æ¡£ç¢ç‰‡æ¥æ¨¡æ‹Ÿè™šæ‹Ÿdomå®ç°ï¼Œå¦å¤–ä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨æ–‡æ¡£ç¢ç‰‡ï¼Œä¸èƒ½ç›´æ¥éå†èŠ‚ç‚¹å—ï¼Ÿç›´æ¥éå†ä¹Ÿæ˜¯å¯ä»¥çš„ä½†æ˜¯è¿™æ ·ä¸€æ¥ç”±äºä¸åœçš„ä¿®æ”¹èŠ‚ç‚¹åŠ¿å¿…ä¼šé€ æˆå¤§é‡çš„æ€§èƒ½æ¶ˆè€—ï¼Œè€Œé€šè¿‡æ–‡æ¡£ç¢ç‰‡åœ¨æ‰€æœ‰èŠ‚ç‚¹éå†å®Œæˆååªéœ€è¦ä¸€æ¬¡æ¶ˆè€—ï¼Œè¿™æ ·å°±å¤§å¤§é™ä½äº†å›æµé‡æ±‡å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">nodeTofragment</span>(<span class="params">el, vm</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> fragment = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>();</span><br><span class="line">    <span class="keyword">let</span> child;</span><br><span class="line">    <span class="keyword">while</span>(child = el.<span class="property">firstChild</span>)&#123;</span><br><span class="line">        <span class="title function_">compile</span>(child, vm);<span class="comment">//æ¨¡æ¿ç¼–è¯‘</span></span><br><span class="line">        fragment.<span class="title function_">appendChild</span>(child);<span class="comment">//å°†èŠ‚ç‚¹æ·»åŠ åˆ°æ–‡æ¡£ç¢ç‰‡ä¸­</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">compile</span>(<span class="params">node, vm</span>)&#123;</span><br><span class="line">    <span class="comment">// æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸ªèŠ‚ç‚¹ç±»å‹å±æ€§ï¼ˆnodeTypeï¼‰å¯¹åº”çš„å€¼åˆ†åˆ«æ˜¯ï¼š1å…ƒç´ ã€2æ–‡æœ¬ã€8æ³¨é‡Šå’Œ9æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span>(node.<span class="property">nodeType</span> === <span class="number">1</span>)&#123;<span class="comment">//  å¦‚æœæ˜¯å…ƒç´ èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">// éå†æ‰€æœ‰çš„å±æ€§ï¼Œçœ‹æ˜¯å¦æœ‰v-modelæŒ‡ä»¤</span></span><br><span class="line">        [...node.<span class="property">attributes</span>].<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="regexp">/^v-/</span>.<span class="title function_">test</span>(item.<span class="property">nodeName</span>))&#123;<span class="comment">//nodeNameå°±æ˜¯å±æ€§åï¼Œå¦‚ï¼šclassã€typeã€v-modelç­‰</span></span><br><span class="line">                node.<span class="property">value</span> = vm.<span class="property">$data</span>[item.<span class="property">nodeValue</span>]; <span class="comment">//nodeValueå°±æ˜¯å±æ€§åä¸­å¯¹åº”çš„å€¼ï¼Œå¦‚v-model=&quot;name&quot;ä¸­çš„name</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…ƒç´ èŠ‚ç‚¹è¿˜å¯èƒ½æœ‰å¾ˆå¤šå­èŠ‚ç‚¹æˆ–å­™å­èŠ‚ç‚¹ç­‰ï¼Œå› æ­¤è¿˜éœ€é€’å½’å¤„ç†</span></span><br><span class="line">        [...node.<span class="property">childNodes</span>].<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="title function_">compile</span>(item, vm);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(node.<span class="property">nodeType</span> === <span class="number">3</span>)&#123; <span class="comment">// å¦‚æœæ˜¯æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">// æ£€æµ‹è¯¥æ–‡æœ¬ä¸­æ˜¯å¦åŒ…å«å°èƒ¡å­è¯­æ³•</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="regexp">/\&#123;\&#123;\w+\&#125;\&#125;/</span>.<span class="title function_">test</span>(node.<span class="property">textContent</span>))&#123;</span><br><span class="line">            <span class="comment">// å°†å°èƒ¡å­æ›¿æ¢ä¸ºçœŸæ­£çš„æ•°æ®</span></span><br><span class="line">            node.<span class="property">textContent</span> = node.<span class="property">textContent</span>.<span class="title function_">replace</span>(<span class="regexp">/\&#123;\&#123;(\w+)\&#125;\&#125;/</span>, <span class="keyword">function</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">                <span class="comment">// å‚æ•°aæ˜¯åŒ¹é…åˆ°åˆ°å¤§çš„æ­£åˆ™å†…å®¹</span></span><br><span class="line">                <span class="comment">// å‚æ•°bæ˜¯å°åˆ†ç»„ä¸­åŒ¹é…åˆ°åˆ°å†…å®¹ æ‰€ä»¥bå°±å¯¹åº”çš„dataä¸­å®šä¹‰çš„å±æ€§</span></span><br><span class="line">                <span class="keyword">return</span> vm.<span class="property">$data</span>[b];</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-2-3-åŒå‘ç»‘å®š"><a href="#7-2-3-åŒå‘ç»‘å®š" class="headerlink" title="7.2.3. åŒå‘ç»‘å®š"></a>7.2.3. åŒå‘ç»‘å®š</h4><p>vueä¸»è¦æ˜¯åˆ©ç”¨æ•°æ®åŠ«æŒåŠ å‘å¸ƒè®¢é˜…æ¨¡å¼æ¥å®ç°æ•°æ®çš„åŒå‘ç»‘å®šçš„ã€‚</p>
<p>åœ¨å‰é¢æ•°æ®åŠ«æŒçš„æ—¶å€™æˆ‘ä»¬æåˆ°ï¼Œæ•°æ®åŠ«æŒçš„ç›®çš„å°±æ˜¯ä¸ºäº†åœ¨è·å–æ•°æ®æˆ–ç»™æ•°æ®èµ‹å€¼ä¹‹å‰å¯¹æ•°æ®åšä¸€äº›é¢å¤–çš„æ“ä½œï¼Œé‚£ä¹ˆè¿™äº›é¢å¤–çš„æ“ä½œå…¶å®å°±æ˜¯åˆ©ç”¨å‘å¸ƒè®¢é˜…æ¨¡å¼å¯¹æ•°æ®å±æ€§è¿›è¡Œç›‘æ§ï¼Œæ¯”å¦‚è¯´dataä¸­çš„nameå±æ€§ï¼Œé¦–å…ˆéœ€è¦çŸ¥é“è¿™ä¸ªnameå±æ€§éƒ½åœ¨å“ªé‡Œç”¨åˆ°äº†ï¼Œä»¥ä¾¿åé¢å¦‚æœnameå€¼å‘ç”Ÿæ”¹å˜æ—¶åŠæ—¶é€šçŸ¥ç”¨åˆ°nameçš„åœ°æ–¹åŒæ­¥æ›´æ–°ï¼Œè¿™ä¸ªåœ¨vueä¸­å«åšä¾èµ–æ”¶é›†ã€‚æ€ä¹ˆæ‰èƒ½çŸ¥é“nameå±æ€§éƒ½åœ¨å“ªé‡Œç”¨åˆ°äº†å‘¢ï¼Œè¿™ä¸ªæ—¶å€™æ•°æ®åŠ«æŒå°±æ´¾ä¸Šç”¨åœºäº†ï¼Œå‰é¢è¯´è¿‡åªè¦å¤–ç•Œå¯¹nameè¿›è¡Œè®¿é—®éƒ½ä¼šè§¦å‘Object.definePropertyä¸­çš„getå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹åœ¨getå‡½æ•°ä¸­å¯¹nameå±æ€§è¿›è¡Œç›‘å¬æ”¶é›†ã€‚å¤§æ¦‚å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p>
<blockquote>
<ul>
<li>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªDepç±»ï¼Œç”¨äºå¯¹å±æ€§è¿›è¡Œä¾èµ–æ”¶é›†å’Œé€šçŸ¥ç”¨åˆ°å±æ€§åˆ°åœ°æ–¹è¿›è¡ŒåŒæ­¥æ›´æ–°</li>
<li>ç„¶åå†å®šä¹‰ä¸€ä¸ªWatcherç±»ï¼Œç”¨äºå¯¹å±æ€§è¿›è¡Œç›‘å¬ï¼Œå¹¶å®ç°å±æ€§å€¼çš„åŒæ­¥æ›´æ–°</li>
<li>åœ¨æ¨¡æ¿ç¼–è¯‘çš„æ—¶å€™ï¼Œé€šè¿‡watcheræ¥ç›‘å¬å±æ€§</li>
<li>åœ¨æ•°æ®åŠ«æŒçš„getå‡½æ•°ä¸­è¿›è¡Œä¾èµ–æ”¶é›†</li>
<li>åœ¨æ•°æ®åŠ«æŒçš„setå‡½æ•°ä¸­é€šçŸ¥å„ä¸ªwatcherè¿›è¡Œæ•°æ®æ›´æ–°</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dep</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subs</span> = [];<span class="comment">//äº‹ä»¶æ±  å­˜å‚¨watcherå®ä¾‹å¯¹è±¡</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">addSub</span>(<span class="params">sub</span>)&#123;</span><br><span class="line">        <span class="comment">//subå°±æ˜¯watcherçš„å®ä¾‹</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">push</span>(sub);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">notify</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">            item.<span class="title function_">update</span>();<span class="comment">//è°ƒç”¨watcherçš„update</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Watcher</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">node, key, vm</span>)&#123;</span><br><span class="line">        <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="variable language_">this</span>;<span class="comment">//ç”¨äºæ ‡è¯†åªç”¨é€šè¿‡Watcherç›‘å¬è¿‡çš„å±æ€§æ‰ä¼šè¿›è¡Œä¾èµ–æ”¶é›†</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">node</span> = node;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">key</span> = key;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vm</span> = vm;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getValue</span>();</span><br><span class="line">        <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getValue</span>();<span class="comment">//é¦–å…ˆè·å–ä¸‹æœ€æ–°å€¼</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">nodeType</span> === <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">value</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">nodeType</span> === <span class="number">3</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">textContent</span> = <span class="variable language_">this</span>.<span class="property">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getValue</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">vm</span>.<span class="property">$data</span>[<span class="variable language_">this</span>.<span class="property">key</span>];</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="7-3-å®Œæ•´ä»£ç "><a href="#7-3-å®Œæ•´ä»£ç " class="headerlink" title="7.3.  å®Œæ•´ä»£ç "></a>7.3.  å®Œæ•´ä»£ç </h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒå‘ç»‘å®š</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dep</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span> = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addSubs</span>(<span class="params">sub</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">push</span>(sub)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      item.<span class="title function_">update</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Watcher</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">node, key, vm</span>) &#123;</span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">node</span> = node;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = key;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span> = vm</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getValue</span>();</span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getValue</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">nodeType</span> === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">value</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">nodeType</span> === <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">node</span>.<span class="property">textContent</span> = <span class="variable language_">this</span>.<span class="property">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getValue</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">vm</span>.<span class="property">$data</span>[<span class="variable language_">this</span>.<span class="property">key</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Vue</span>(<span class="params">options</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$data</span> = options.<span class="property">data</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$el</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(options.<span class="property">el</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">observe</span>(<span class="variable language_">this</span>.<span class="property">$data</span>)</span><br><span class="line">  <span class="title function_">nodeTofragment</span>(<span class="variable language_">this</span>.<span class="property">$el</span>, <span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;è¥¿ç“œwatermelon&#x27;</span> &#125;,</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®åŠ«æŒ</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">observe</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> ((&#123;&#125;).<span class="property">toString</span>.<span class="title function_">call</span>(data) !== <span class="string">&#x27;[object Object]&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(data);</span><br><span class="line">  keys.<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">defineReactive$$1</span>(data, key, data[key]);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defineReactive$$1</span>(<span class="params">obj, key, val</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> dep = <span class="keyword">new</span> <span class="title class_">Dep</span>();</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) &#123;</span><br><span class="line">        dep.<span class="title function_">addSubs</span>(<span class="title class_">Dep</span>.<span class="property">target</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> val</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">newV</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (newV !== val) &#123;</span><br><span class="line">        val = newV</span><br><span class="line">        dep.<span class="title function_">notify</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ¿ç¼–è¯‘</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">nodeTofragment</span>(<span class="params">el, vm</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> fragment = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>();</span><br><span class="line">  <span class="keyword">let</span> child;</span><br><span class="line">  <span class="keyword">while</span> (child = el.<span class="property">firstChild</span>) &#123;</span><br><span class="line">    <span class="title function_">compiler</span>(child, vm);</span><br><span class="line">    fragment.<span class="title function_">appendChild</span>(child);</span><br><span class="line">  &#125;</span><br><span class="line">  el.<span class="title function_">appendChild</span>(fragment)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">compiler</span>(<span class="params">node, vm</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (node.<span class="property">nodeType</span> === <span class="number">1</span>) &#123;<span class="comment">//å…ƒç´ èŠ‚ç‚¹</span></span><br><span class="line">    [...node.<span class="property">attributes</span>].<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="regexp">/^v-/</span>.<span class="title function_">test</span>(item.<span class="property">nodeName</span>)) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Watcher</span>(node, item.<span class="property">nodeValue</span>, vm)</span><br><span class="line">        node.<span class="property">value</span> = vm.<span class="property">$data</span>[item.<span class="property">nodeValue</span>];</span><br><span class="line">        node.<span class="title function_">addEventListener</span>(<span class="string">&#x27;input&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          vm.<span class="property">$data</span>[item.<span class="property">nodeValue</span>] = node.<span class="property">value</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    [...node.<span class="property">childNodes</span>].<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">compiler</span>(item, vm);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.<span class="property">nodeType</span> === <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/\&#123;\&#123;\w+\&#125;\&#125;/</span>.<span class="title function_">test</span>(node.<span class="property">textContent</span>)) &#123;</span><br><span class="line"></span><br><span class="line">      node.<span class="property">textContent</span> = node.<span class="property">textContent</span>.<span class="title function_">replace</span>(<span class="regexp">/\&#123;\&#123;(\w+)\&#125;\&#125;/</span>, <span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Watcher</span>(node, b, vm)</span><br><span class="line">        <span class="keyword">return</span> vm.<span class="property">$data</span>[b]</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>æˆ‘è‡ªå·±ä¸ªçš„vue - mvvm<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="8-è®¾è®¡æ¨¡å¼"><a href="#8-è®¾è®¡æ¨¡å¼" class="headerlink" title="8. è®¾è®¡æ¨¡å¼"></a>8. è®¾è®¡æ¨¡å¼</h2><h3 id="8-1-è§‚å¯Ÿè€…æ¨¡å¼"><a href="#8-1-è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="8.1. è§‚å¯Ÿè€…æ¨¡å¼"></a>8.1. è§‚å¯Ÿè€…æ¨¡å¼</h3><p>å½“å¯¹è±¡ä¹‹é—´å­˜åœ¨ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œè¿™å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p>
<p>åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œåªæœ‰ä¸¤ç§ä¸»ä½“ï¼šç›®æ ‡å¯¹è±¡ (<code>Object</code>) å’Œ è§‚å¯Ÿè€… (<code>Observer</code>)ã€‚å®—é—¨ä»»åŠ¡å¤§æ®¿å°±æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œå¼Ÿå­ä»¬å°±æ˜¯è§‚å¯Ÿè€…ã€‚</p>
<ul>
<li>ç›®æ ‡å¯¹è±¡ <code>Subject</code>ï¼š<ul>
<li>ç»´æŠ¤è§‚å¯Ÿè€…åˆ—è¡¨ <code>observerList</code> â€”â€”â€”â€” ç»´æŠ¤æ‹¥æœ‰è®¢é˜…æƒé™çš„å¼Ÿå­åˆ—è¡¨</li>
<li>å®šä¹‰æ·»åŠ è§‚å¯Ÿè€…çš„æ–¹æ³• â€”â€”â€”â€” æä¾›å¼Ÿå­è´­ä¹°è®¢é˜…æƒé™çš„åŠŸèƒ½</li>
<li>å½“è‡ªèº«å‘ç”Ÿå˜åŒ–åï¼Œé€šè¿‡è°ƒç”¨è‡ªå·±çš„ <code>notify</code> æ–¹æ³•ä¾æ¬¡é€šçŸ¥æ¯ä¸ªè§‚å¯Ÿè€…æ‰§è¡Œ <code>update</code> æ–¹æ³• â€”â€”â€”â€” å‘å¸ƒå¯¹åº”ä»»åŠ¡åé€šçŸ¥æœ‰è®¢é˜…æƒé™çš„å¼Ÿå­</li>
</ul>
</li>
<li>è§‚å¯Ÿè€… <code>Observer</code> éœ€è¦å®ç° <code>update</code> æ–¹æ³•ï¼Œä¾›ç›®æ ‡å¯¹è±¡è°ƒç”¨ã€‚<code>update</code>æ–¹æ³•ä¸­å¯ä»¥æ‰§è¡Œè‡ªå®šä¹‰çš„ä¸šåŠ¡é€»è¾‘ â€”â€”â€”â€” å¼Ÿå­ä»¬éœ€è¦å®šä¹‰æ¥æ”¶ä»»åŠ¡é€šçŸ¥åçš„æ–¹æ³•ï¼Œä¾‹å¦‚å»æŠ¢ä»»åŠ¡æˆ–ä»»åŠ¡ä¸é€‚åˆï¼Œç»§ç»­ç­‰å¾…ä¸‹ä¸€ä¸ªä»»åŠ¡</li>
</ul>
<p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20220715000730818.png" alt="image-20220715000730818"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params">&#123;taskType, taskInfo&#125;</span>) &#123;</span><br><span class="line">        <span class="comment">// å‡è®¾ä»»åŠ¡åˆ†ä¸ºæ—¥å¸¸routeå’Œæˆ˜æ–—war</span></span><br><span class="line">        <span class="keyword">if</span> (taskType === <span class="string">&quot;route&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>ä¸éœ€è¦æ—¥å¸¸ä»»åŠ¡`</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">goToTaskHome</span>(taskInfo);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">goToTaskHome</span>(<span class="params">info</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>å»ä»»åŠ¡å¤§æ®¿æŠ¢<span class="subst">$&#123;info&#125;</span>ä»»åŠ¡`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">observerList</span> = []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">addObserver</span>(<span class="params">observer</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">observerList</span>.<span class="title function_">push</span>(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">notify</span>(<span class="params">task</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å‘å¸ƒäº”æ˜Ÿä»»åŠ¡&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">observerList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">observer</span> =&gt;</span> observer.<span class="title function_">update</span>(task))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> <span class="title class_">Subject</span>();</span><br><span class="line"><span class="keyword">const</span> stu1 = <span class="keyword">new</span> <span class="title class_">Observer</span>(<span class="string">&quot;å¼Ÿå­1&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> stu2 = <span class="keyword">new</span> <span class="title class_">Observer</span>(<span class="string">&quot;å¼Ÿå­2&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// stu1 stu2 è´­ä¹°äº”æ˜Ÿä»»åŠ¡é€šçŸ¥æƒé™</span></span><br><span class="line">subject.<span class="title function_">addObserver</span>(stu1);</span><br><span class="line">subject.<span class="title function_">addObserver</span>(stu2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»»åŠ¡æ®¿å‘å¸ƒäº”æ˜Ÿæˆ˜æ–—ä»»åŠ¡</span></span><br><span class="line"><span class="keyword">const</span> warTask = &#123;</span><br><span class="line">    <span class="attr">taskType</span>: <span class="string">&#x27;war&#x27;</span>,</span><br><span class="line">    <span class="attr">taskInfo</span>: <span class="string">&quot;çŒæ€æ—¶åˆ»&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»»åŠ¡å¤§æ®¿é€šçŸ¥è´­ä¹°æƒé™å¼Ÿå­</span></span><br><span class="line">subject.<span class="title function_">notify</span>(warTask);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»»åŠ¡æ®¿å‘å¸ƒäº”æ˜Ÿæ—¥å¸¸ä»»åŠ¡</span></span><br><span class="line"><span class="keyword">const</span> routeTask = &#123;</span><br><span class="line">    <span class="attr">taskType</span>: <span class="string">&#x27;route&#x27;</span>,</span><br><span class="line">    <span class="attr">taskInfo</span>: <span class="string">&quot;ç§æ ‘æµ‡æ°´&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">subject.<span class="title function_">notify</span>(routeTask);</span><br></pre></td></tr></table></figure>

<h3 id="8-2-å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#8-2-å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="8.2. å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>8.2. å‘å¸ƒè®¢é˜…æ¨¡å¼</h3><ul>
<li>åŸºæœ¬æ¦‚å¿µ</li>
</ul>
<blockquote>
<p>åŸºäºä¸€ä¸ªäº‹ä»¶ï¼ˆä¸»é¢˜ï¼‰é€šé“ï¼Œå¸Œæœ›æ¥æ”¶é€šçŸ¥çš„å¯¹è±¡ <code>Subscriber</code> é€šè¿‡è‡ªå®šä¹‰äº‹ä»¶è®¢é˜…ä¸»é¢˜ï¼Œè¢«æ¿€æ´»äº‹ä»¶çš„å¯¹è±¡ <code>Publisher</code> é€šè¿‡å‘å¸ƒä¸»é¢˜äº‹ä»¶çš„æ–¹å¼é€šçŸ¥å„ä¸ªè®¢é˜…è¯¥ä¸»é¢˜çš„ <code>Subscriber</code> å¯¹è±¡ã€‚</p>
</blockquote>
<p>å› æ­¤å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸è§‚å¯Ÿè€…æ¨¡å¼ç›¸æ¯”ï¼Œå‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­æœ‰ä¸‰ä¸ªè§’è‰²ï¼Œå‘å¸ƒè€… <code>Publisher</code> ï¼Œäº‹ä»¶è°ƒåº¦ä¸­å¿ƒ <code>Event Channel</code> ï¼Œè®¢é˜…è€… <code>Subscriber</code> ã€‚</p>
<p>æˆ‘ä»¬ç»§ç»­ä»¥å¼Ÿå­é¢†å–ä»»åŠ¡ä¸ºæ —å­ï¼Œå®—é—¨æ„Ÿè§‰æŠŠä»»åŠ¡è®¢é˜…æ”¾åœ¨ä»»åŠ¡å¤§æ®¿ä¸­æœ‰äº›ç¹çï¼Œäºæ˜¯å†³å®šåœ¨ä»»åŠ¡å¤§æ®¿å’Œå¼Ÿå­ä¸­é—´æ·»åŠ <strong>ä¸­ä»‹</strong>ã€‚å¼Ÿå­åœ¨ä¸­ä»‹ä¸­è®¢é˜…å…¶éœ€è¦çš„ä»»åŠ¡ç±»å‹ï¼Œå½“ä»»åŠ¡å¤§æ®¿å‘å¸ƒä»»åŠ¡åï¼Œä¸­ä»‹ä¼šå°†å‘å¸ƒä»»åŠ¡ç»™å¯¹åº”çš„è®¢é˜…è€…ã€‚</p>
<ul>
<li><p>å®—é—¨ä»»åŠ¡å¤§æ®¿: ä»»åŠ¡å‘å¸ƒè€… â€”â€” <code>Publisher</code></p>
</li>
<li><p>ä¸­ä»‹åŠŸèƒ½ â€”â€” <code>Event Channel</code></p>
<ul>
<li><p>ç»´æŠ¤ä»»åŠ¡ç±»å‹ï¼Œä»¥åŠæ¯ç§ä»»åŠ¡ä¸‹çš„è®¢é˜…æƒ…å†µ</p>
</li>
<li><p>ç»™è®¢é˜…è€…æä¾›è®¢é˜…åŠŸèƒ½ â€”â€” <code>subscribe</code> åŠŸèƒ½</p>
</li>
<li><p>å½“å®—é—¨å‘å¸ƒä»»åŠ¡åï¼Œä¸­ä»‹ä¼šç»™æ‰€æœ‰çš„è®¢é˜…è€…å‘å¸ƒä»»åŠ¡ â€”â€” <code>publish</code> åŠŸèƒ½</p>
</li>
</ul>
</li>
<li><p>å¼Ÿå­: ä»»åŠ¡æ¥å—è€… â€”â€” <code>Subscriber</code></p>
</li>
</ul>
<p><img src="https://peng-img.oss-cn-shanghai.aliyuncs.com/markdown-img/image-20220715000719802.png" alt="image-20220715000719802"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PubSub</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// äº‹ä»¶ä¸­å¿ƒ</span></span><br><span class="line">        <span class="comment">// å­˜å‚¨æ ¼å¼: warTask: [], routeTask: []</span></span><br><span class="line">        <span class="comment">// æ¯ç§äº‹ä»¶(ä»»åŠ¡)ä¸‹å­˜æ”¾å…¶è®¢é˜…è€…çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">events</span> = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®¢é˜…æ–¹æ³•</span></span><br><span class="line">    <span class="title function_">subscribe</span>(<span class="params">type, cb</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">events</span>[type]) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">events</span>[type] = [];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">events</span>[type].<span class="title function_">push</span>(cb);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å‘å¸ƒæ–¹æ³•</span></span><br><span class="line">    <span class="title function_">publish</span>(<span class="params">type, ...args</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">events</span>[type]) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">events</span>[type].<span class="title function_">forEach</span>(<span class="function"><span class="params">cb</span> =&gt;</span> <span class="title function_">cb</span>(...args))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å–æ¶ˆè®¢é˜…æ–¹æ³•</span></span><br><span class="line">    <span class="title function_">unsubscribe</span>(<span class="params">type, cb</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">events</span>[type]) &#123;</span><br><span class="line">            <span class="keyword">const</span> cbIndex = <span class="variable language_">this</span>.<span class="property">events</span>[type].<span class="title function_">findIndex</span>(<span class="function"><span class="params">e</span>=&gt;</span> e === cb)</span><br><span class="line">            <span class="keyword">if</span> (cbIndex != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">events</span>[type].<span class="title function_">splice</span>(cbIndex, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">events</span>[type].<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">events</span>[type];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">unsubscribeAll</span>(<span class="params">type</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">events</span>[type]) &#123;</span><br><span class="line">            <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">events</span>[type];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªä¸­ä»‹å…¬å¸</span></span><br><span class="line"><span class="keyword">let</span> pubsub = <span class="keyword">new</span> <span class="title class_">PubSub</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼Ÿå­ä¸€è®¢é˜…æˆ˜æ–—ä»»åŠ¡</span></span><br><span class="line">pubsub.<span class="title function_">subscribe</span>(<span class="string">&#x27;warTask&#x27;</span>, <span class="keyword">function</span> (<span class="params">taskInfo</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å®—é—¨æ®¿å‘å¸ƒæˆ˜æ–—ä»»åŠ¡ï¼Œä»»åŠ¡ä¿¡æ¯:&quot;</span> + taskInfo);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// å¼Ÿå­ä¸€è®¢é˜…æˆ˜æ–—ä»»åŠ¡</span></span><br><span class="line">pubsub.<span class="title function_">subscribe</span>(<span class="string">&#x27;routeTask&#x27;</span>, <span class="keyword">function</span> (<span class="params">taskInfo</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å®—é—¨æ®¿å‘å¸ƒæ—¥å¸¸ä»»åŠ¡ï¼Œä»»åŠ¡ä¿¡æ¯:&quot;</span> + taskInfo);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// å¼Ÿå­ä¸‰è®¢é˜…å…¨ç±»å‹ä»»åŠ¡</span></span><br><span class="line">pubsub.<span class="title function_">subscribe</span>(<span class="string">&#x27;allTask&#x27;</span>, <span class="keyword">function</span> (<span class="params">taskInfo</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å®—é—¨æ®¿å‘å¸ƒäº”æ˜Ÿä»»åŠ¡ï¼Œä»»åŠ¡ä¿¡æ¯:&quot;</span> + taskInfo);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘å¸ƒæˆ˜æ–—ä»»åŠ¡</span></span><br><span class="line">pubsub.<span class="title function_">publish</span>(<span class="string">&#x27;warTask&#x27;</span>, <span class="string">&quot;çŒæ€æ—¶åˆ»&quot;</span>);</span><br><span class="line">pubsub.<span class="title function_">publish</span>(<span class="string">&#x27;allTask&#x27;</span>, <span class="string">&quot;çŒæ€æ—¶åˆ»&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘å¸ƒæ—¥å¸¸ä»»åŠ¡</span></span><br><span class="line">pubsub.<span class="title function_">publish</span>(<span class="string">&#x27;routeTask&#x27;</span>, <span class="string">&quot;ç§æ ‘æµ‡æ°´&quot;</span>);</span><br><span class="line">pubsub.<span class="title function_">publish</span>(<span class="string">&#x27;allTask&#x27;</span>, <span class="string">&quot;ç§æ ‘æµ‡æ°´&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>åœ¨å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­ï¼Œå‘å¸ƒè€…å’Œè®¢é˜…è€…ä¸çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ã€‚éœ€è¦ç¬¬ä¸‰æ–¹ä¸­ä»‹ï¼Œå°†è®¢é˜…è€…å’Œå‘å¸ƒè€…ä¸²è”èµ·æ¥ï¼Œåˆ©ç”¨ä¸­ä»‹è¿‡æ»¤å’Œåˆ†é…æ‰€æœ‰è¾“å…¥çš„æ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å‘å¸ƒ-è®¢é˜…æ¨¡å¼ç”¨æ¥å¤„ç†ä¸åŒç³»ç»Ÿç»„ä»¶çš„ä¿¡æ¯äº¤æµï¼Œå³ä½¿è¿™äº›ç»„ä»¶ä¸çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨</strong>ã€‚</p>
</blockquote>
<h4 id="8-3-è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼çš„å·®å¼‚"><a href="#8-3-è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼çš„å·®å¼‚" class="headerlink" title="8.3. è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼çš„å·®å¼‚"></a>8.3. è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼çš„å·®å¼‚</h4><table>
<thead>
<tr>
<th>è®¾è®¡æ¨¡å¼</th>
<th>è§‚å¯Ÿè€…æ¨¡å¼</th>
<th>å‘å¸ƒè®¢é˜…æ¨¡å¼</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸»ä½“</td>
<td>Objectè§‚å¯Ÿè€…ã€Subjectç›®æ ‡å¯¹è±¡</td>
<td>Publisherå‘å¸ƒè€…ã€Event Channeläº‹ä»¶ä¸­å¿ƒã€Subscribeè®¢é˜…è€…</td>
</tr>
<tr>
<td>ä¸»ä½“å…³ç³»</td>
<td>Subjectä¸­é€šè¿‡observerListè®°å½•ObServer</td>
<td>Publisherå’ŒSubscribeä¸æƒ³ä¸çŸ¥é“å¯¹æ–¹ï¼Œé€šè¿‡ä¸­ä»‹è”ç³»</td>
</tr>
<tr>
<td>ä¼˜ç‚¹</td>
<td>è§’è‰²æ˜ç¡®ï¼ŒSubjectå’ŒObjectè¦éµå¾ªçº¦å®šçš„æˆå‘˜æ–¹æ³•</td>
<td>æ¾æ•£è€¦åˆï¼Œçµæ´»åº¦é«˜ï¼Œé€šå¸¸åº”ç”¨åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­</td>
</tr>
<tr>
<td>ç¼ºç‚¹</td>
<td>ç´§è€¦åˆ</td>
<td>å½“äº‹ä»¶ç±»å‹å˜å¤šæ—¶ï¼Œä¼šå¢åŠ ç»´æŠ¤æˆæœ¬</td>
</tr>
<tr>
<td>ä½¿ç”¨æ¡ˆä¾‹</td>
<td>åŒå‘æ•°æ®ç»‘å®š</td>
<td>äº‹ä»¶æ€»çº¿EventBus</td>
</tr>
</tbody></table>
  </div>
  
    
      <a id="older" class="blog-nav" href="/article/%E9%BB%84%E9%AA%8F%E8%80%81%E5%B8%88%E4%B8%AD%E5%9B%BD%E8%BF%91%E7%8E%B0%E4%BB%A3%E5%8F%B2%E7%BA%B2%E8%A6%812022%E9%87%8D%E7%82%B9%E6%95%B4%E7%90%86/">OLDER&nbsp;&gt;</a>
      
        
          <a id="newer" class="blog-nav" href="/article/TypeScript%E5%85%A5%E9%97%A8/">&lt;&nbsp;NEWER</a>
          
            
</div>
        <div class="footer">
  
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/Pengzna">Copyright Â© Pengzna 2021-present</a>
        
    </div>
  
</div>

      </div>

      <div class="back-to-top hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



      
  <div class="search-icon" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-box">
        <div class="search-title">
          <!-- <span class="search-icon-input">
            <a href="javascript: void(0)">
              <i class="iconfont icon-search"></i>
            </a>
          </span> -->
          
            <input type="text" class="search-input" id="search-input" placeholder="æœç´¢">
          
          <span class="search-close-icon" id="search-close-icon">
            <a href="javascript: void(0)">
              <i class="iconfont icon-close"></i>
            </a>
          </span>
        </div>
        <div class="search-result" id="search-result"></div>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    // inputArea.onclick = function() {
    //   getSearchFile()
    //   this.onclick = null
    // }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        inputArea.focus()
        getSearchFile()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'><span></ul>";
      // $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'><h2>" + orig_data_title + "</h2></a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<h3 class=\"search-result-abstract\">" + match_content + "...</h3>"
                }
                str += "<hr></li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer toï¼š<a href='https://github.com/leedom92/hexo-theme-leedom#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




    </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  </body>
</html>
